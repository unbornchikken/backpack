"use strict";
var _ = require("lodash");
function Serializer(options) {
  this.options = {ignoreNativeFunc: true};
  if (options !== undefined) {
    _.extend(this.options, options);
  }
  this._knonwTypes = {};
  this._registerDefaultKnownTypes();
}
Serializer.prototype._registerDefaultKnownTypes = function() {
  this.registerKnownType("Map", Map);
  this.registerKnownType("Set", Set);
};
Serializer.prototype.registerKnownType = function(typeName, type) {
  if (!_.isString(typeName)) {
    throw new TypeError("Parameter 'alias' is not a string.");
  }
  if (!type) {
    throw new Error("Argument 'type' is expected.");
  }
  var typeOfType = typeof type;
  switch (typeOfType) {
    case "string":
      type = require(type);
      break;
    case "function":
      break;
    default:
      throw new TypeError("Argument 'type' value is unrecognised.");
  }
  if (_.isUndefined(type.prototype)) {
    throw new TypeError("Argument 'type' is not a constructor.");
  }
  this._knonwTypes[typeName] = type.prototype;
};
Serializer.prototype._setTypeTag = function(outputObj, obj) {
  if (obj.constructor && obj.constructor !== Object) {
    for (var n in this._knonwTypes) {
      var v = this._knonwTypes[n];
      if (v === obj.constructor.prototype) {
        outputObj[Serializer.TYPETAG] = n;
        return;
      }
    }
  }
};
Serializer.prototype._setProto = function(obj, typeTag) {
  typeTag = typeTag || obj[Serializer.TYPETAG];
  if (typeTag) {
    var type = this._knonwTypes[typeTag];
    if (_.isUndefined(type)) {
      throw new Error("Type '" + typeTag + "' has not been registered.");
    }
    Object.setPrototypeOf(obj, type);
    delete obj[Serializer.TYPETAG];
  }
};
Serializer.prototype.stringify = function(obj) {
  var json = this.toJSON(obj);
  return _.isNull(json) ? null : JSON.stringify(json);
};
Serializer.prototype.toJSON = function(obj) {
  if (_.isUndefined(obj)) {
    throw new Error("Argument expected.");
  }
  if (_.isNull(obj)) {
    return null;
  }
  return this._serialize(obj, new Map(), []);
};
Serializer.prototype._serialize = function(obj, cache, path) {
  if (typeof obj === "object") {
    cache.set(obj, path);
    var toJSON = false;
    var pObj = obj;
    var serializeToJSON = obj.serializeToJSON || obj._serializeToJSON;
    if (_.isFunction(serializeToJSON) && (_.isFunction(obj.deserializeFromJSON) || _.isFunction(obj._deserializeFromJSON))) {
      obj = serializeToJSON.call(obj);
      if (!_.isObject(obj) || _.isArray(obj)) {
        throw new Error(pObj.constructor.name + ".serializeToJSON has returned not an object.");
      }
      toJSON = true;
    }
    if (obj instanceof Map) {
      var data = {data: []};
      var $__4 = true;
      var $__5 = false;
      var $__6 = undefined;
      try {
        for (var $__2 = void 0,
            $__1 = (obj.entries())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
          var kvp = $__2.value;
          {
            data.data.push(kvp);
          }
        }
      } catch ($__7) {
        $__5 = true;
        $__6 = $__7;
      } finally {
        try {
          if (!$__4 && $__1.return != null) {
            $__1.return();
          }
        } finally {
          if ($__5) {
            throw $__6;
          }
        }
      }
      obj = data;
      toJSON = true;
    }
    if (obj instanceof Set) {
      var data$__15 = {data: []};
      var $__11 = true;
      var $__12 = false;
      var $__13 = undefined;
      try {
        for (var $__9 = void 0,
            $__8 = (obj.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__11 = ($__9 = $__8.next()).done); $__11 = true) {
          var value = $__9.value;
          {
            data$__15.data.push(value);
          }
        }
      } catch ($__14) {
        $__12 = true;
        $__13 = $__14;
      } finally {
        try {
          if (!$__11 && $__8.return != null) {
            $__8.return();
          }
        } finally {
          if ($__12) {
            throw $__13;
          }
        }
      }
      obj = data$__15;
      toJSON = true;
    }
    var outputObj = Array.isArray(obj) ? [] : {};
    if (toJSON) {
      outputObj[Serializer.TOJSONTAG] = true;
    }
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        var subObject = obj[key];
        var typeOfSubObject = typeof subObject;
        if (typeOfSubObject === "object" && subObject !== null) {
          var found = false;
          var subObjectPath = cache.get(subObject);
          if (!_.isUndefined(subObjectPath)) {
            var pathMarker = {};
            pathMarker[Serializer.CIRCULARFLAG] = subObjectPath;
            outputObj[key] = pathMarker;
            found = true;
          }
          if (!found) {
            var newPath = path.slice(0);
            newPath.push(key);
            outputObj[key] = this._serialize(subObject, cache, newPath);
          }
        } else if (typeOfSubObject === "function") {
          var funcStr = subObject.toString();
          if (Serializer.ISNATIVEFUNC.test(funcStr)) {
            if (this.options.ignoreNativeFunc) {
              funcStr = "function() {throw new Error('Call a native function unserialized')}";
            } else {
              throw new Error("Can't serialize a object with a native function property.");
            }
          }
          outputObj[key] = Serializer.FUNCFLAG + funcStr;
        } else {
          outputObj[key] = subObject;
        }
      }
    }
    this._setTypeTag(outputObj, pObj);
    return outputObj;
  } else {
    return obj;
  }
};
Serializer.prototype.parse = function(str) {
  if (_.isUndefined(str)) {
    throw new Error("Argument expected.");
  }
  if (_.isNull(str)) {
    return null;
  }
  if (!_.isString(str)) {
    throw new TypeError("Argument is not a string.");
  }
  return this.fromJSON(JSON.parse(str));
};
Serializer.prototype.fromJSON = function(json) {
  if (_.isUndefined(json)) {
    throw new Error("Argument expected.");
  }
  if (_.isNull(json)) {
    return null;
  }
  return this._unserialize(json);
};
Serializer.prototype._unserialize = function(obj, originObj, circularTasks) {
  if (typeof obj === "object") {
    originObj = originObj || obj;
    circularTasks = circularTasks || [];
    var result = null;
    var fromJSON = false;
    if (obj !== null) {
      fromJSON = obj[Serializer.TOJSONTAG] === true;
      result = Array.isArray(obj) ? [] : {};
      for (var key in obj) {
        if (key !== Serializer.TOJSONTAG) {
          var subObject = obj[key];
          var typeOfSubObj = typeof subObject;
          if (typeOfSubObj === "object") {
            var circPath = subObject && subObject[Serializer.CIRCULARFLAG];
            if (Array.isArray(circPath)) {
              result[key] = circPath;
              circularTasks.push({
                obj: result,
                key: key
              });
            } else {
              result[key] = this._unserialize(subObject, originObj, circularTasks);
            }
          } else if (typeOfSubObj === "string") {
            if (subObject.indexOf(Serializer.FUNCFLAG) === 0) {
              result[key] = eval("(" + subObject.substring(Serializer.FUNCFLAG.length) + ")").bind(result);
            } else {
              result[key] = subObject;
            }
          } else {
            result[key] = subObject;
          }
        }
      }
    }
    if (originObj === obj) {
      circularTasks.forEach(function(task) {
        task.obj[task.key] = Serializer._getKeyPath(result, task.obj[task.key]);
      });
    }
    if (result !== null) {
      if (fromJSON) {
        var type = result[Serializer.TYPETAG];
        if (type === "Map") {
          var map = new Map();
          var $__4 = true;
          var $__5 = false;
          var $__6 = undefined;
          try {
            for (var $__2 = void 0,
                $__1 = (result.data)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
              var kvp = $__2.value;
              {
                map.set(kvp[0], kvp[1]);
              }
            }
          } catch ($__7) {
            $__5 = true;
            $__6 = $__7;
          } finally {
            try {
              if (!$__4 && $__1.return != null) {
                $__1.return();
              }
            } finally {
              if ($__5) {
                throw $__6;
              }
            }
          }
          return map;
        } else if (type === "Set") {
          var set = new Set();
          var $__11 = true;
          var $__12 = false;
          var $__13 = undefined;
          try {
            for (var $__9 = void 0,
                $__8 = (result.data)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__11 = ($__9 = $__8.next()).done); $__11 = true) {
              var value = $__9.value;
              {
                set.add(value);
              }
            }
          } catch ($__14) {
            $__12 = true;
            $__13 = $__14;
          } finally {
            try {
              if (!$__11 && $__8.return != null) {
                $__8.return();
              }
            } finally {
              if ($__12) {
                throw $__13;
              }
            }
          }
          return set;
        } else {
          var realResult = {};
          this._setProto(realResult, result[Serializer.TYPETAG]);
          var deserializeFromJSON = realResult.deserializeFromJSON || realResult._deserializeFromJSON;
          if (_.isFunction(deserializeFromJSON)) {
            deserializeFromJSON.call(realResult, result);
          } else {
            throw new Error(result.constructor.name + ".deserializeFromJSON function not found.");
          }
          return realResult;
        }
      } else {
        if (typeof result === "object") {
          this._setProto(result);
        }
      }
    }
    return result;
  } else {
    return obj;
  }
};
Serializer._getKeyPath = function(originObj, path) {
  var currentObj = originObj;
  path.forEach(function(p, index) {
    currentObj = currentObj[p];
  });
  return currentObj;
};
Serializer.FUNCFLAG = "_$$ND_FUNC$$_";
Serializer.CIRCULARFLAG = "_$$ND_CC$$_";
Serializer.TYPETAG = "_$$TAG_TYPE$$_";
Serializer.TOJSONTAG = "_$$TAG_TOJSON$$_";
Serializer.ISNATIVEFUNC = /^function\s*[^(]*\(.*\)\s*\{\s*\[native code\]\s*\}$/;
module.exports = Serializer;
//# sourceMappingURL=data:application/json;base64,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RCxnQkFBTSxJQUFJLE1BQUksQUFBQyxDQUFDLE1BQUssWUFBWSxLQUFLLEVBQUksMkNBQXlDLENBQUMsQ0FBQztVQUN6RjtBQUFBLEFBQ0EsZUFBTyxXQUFTLENBQUM7UUFDckI7QUFBQSxNQUNKLEtBQ0s7QUFDRCxXQUFJLE1BQU8sT0FBSyxDQUFBLEdBQU0sU0FBTyxDQUFHO0FBQzVCLGFBQUcsVUFBVSxBQUFDLENBQUMsTUFBSyxDQUFDLENBQUM7UUFDMUI7QUFBQSxNQUNKO0FBQUEsSUFDSjtBQUFBLEFBRUEsU0FBTyxPQUFLLENBQUM7RUFDakIsS0FDSztBQUNELFNBQU8sSUFBRSxDQUFDO0VBQ2Q7QUFBQSxBQUNKLENBQUM7QUFFRCxTQUFTLFlBQVksRUFBSSxVQUFVLFNBQVEsQ0FBRyxDQUFBLElBQUcsQ0FBRztBQUNoRCxBQUFJLElBQUEsQ0FBQSxVQUFTLEVBQUksVUFBUSxDQUFDO0FBQzFCLEtBQUcsUUFBUSxBQUFDLENBQ1IsU0FBVSxDQUFBLENBQUcsQ0FBQSxLQUFJLENBQUc7QUFDaEIsYUFBUyxFQUFJLENBQUEsVUFBUyxDQUFFLENBQUEsQ0FBQyxDQUFDO0VBQzlCLENBQUMsQ0FBQztBQUNOLE9BQU8sV0FBUyxDQUFDO0FBQ3JCLENBQUM7QUFFRCxTQUFTLFNBQVMsRUFBSSxnQkFBYyxDQUFDO0FBQ3JDLFNBQVMsYUFBYSxFQUFJLGNBQVksQ0FBQztBQUN2QyxTQUFTLFFBQVEsRUFBSSxpQkFBZSxDQUFDO0FBQ3JDLFNBQVMsVUFBVSxFQUFJLG1CQUFpQixDQUFDO0FBQ3pDLFNBQVMsYUFBYSxFQUFJLHVEQUFxRCxDQUFDO0FBRWhGLEtBQUssUUFBUSxFQUFJLFdBQVMsQ0FBQztBQUFBIiwiZmlsZSI6InN5c3RlbS9zZXJpYWxpemVyLmpzIiwic291cmNlUm9vdCI6ImxpYi9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbi8qIGpzaGludCAtVzA2MSAqL1xyXG5cclxubGV0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xyXG5cclxuZnVuY3Rpb24gU2VyaWFsaXplcihvcHRpb25zKSB7XHJcbiAgICB0aGlzLm9wdGlvbnMgPSB7XHJcbiAgICAgICAgaWdub3JlTmF0aXZlRnVuYzogdHJ1ZVxyXG4gICAgfTtcclxuICAgIGlmIChvcHRpb25zICE9PSB1bmRlZmluZWQpIHtcclxuICAgICAgICBfLmV4dGVuZCh0aGlzLm9wdGlvbnMsIG9wdGlvbnMpO1xyXG4gICAgfVxyXG4gICAgdGhpcy5fa25vbndUeXBlcyA9IHt9O1xyXG4gICAgdGhpcy5fcmVnaXN0ZXJEZWZhdWx0S25vd25UeXBlcygpO1xyXG59XHJcblxyXG5TZXJpYWxpemVyLnByb3RvdHlwZS5fcmVnaXN0ZXJEZWZhdWx0S25vd25UeXBlcyA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMucmVnaXN0ZXJLbm93blR5cGUoXCJNYXBcIiwgTWFwKTtcclxuICAgIHRoaXMucmVnaXN0ZXJLbm93blR5cGUoXCJTZXRcIiwgU2V0KTtcclxufTtcclxuXHJcblNlcmlhbGl6ZXIucHJvdG90eXBlLnJlZ2lzdGVyS25vd25UeXBlID0gZnVuY3Rpb24gKHR5cGVOYW1lLCB0eXBlKSB7XHJcbiAgICBpZiAoIV8uaXNTdHJpbmcodHlwZU5hbWUpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlBhcmFtZXRlciAnYWxpYXMnIGlzIG5vdCBhIHN0cmluZy5cIik7XHJcbiAgICB9XHJcbiAgICBpZiAoIXR5cGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBcmd1bWVudCAndHlwZScgaXMgZXhwZWN0ZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgbGV0IHR5cGVPZlR5cGUgPSB0eXBlb2YgdHlwZTtcclxuICAgIHN3aXRjaCAodHlwZU9mVHlwZSkge1xyXG4gICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcclxuICAgICAgICAgICAgdHlwZSA9IHJlcXVpcmUodHlwZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJmdW5jdGlvblwiOlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0IDpcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICd0eXBlJyB2YWx1ZSBpcyB1bnJlY29nbmlzZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKF8uaXNVbmRlZmluZWQodHlwZS5wcm90b3R5cGUpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICd0eXBlJyBpcyBub3QgYSBjb25zdHJ1Y3Rvci5cIik7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9rbm9ud1R5cGVzW3R5cGVOYW1lXSA9IHR5cGUucHJvdG90eXBlO1xyXG59O1xyXG5cclxuU2VyaWFsaXplci5wcm90b3R5cGUuX3NldFR5cGVUYWcgPSBmdW5jdGlvbiAob3V0cHV0T2JqLCBvYmopIHtcclxuICAgIGlmIChvYmouY29uc3RydWN0b3IgJiYgb2JqLmNvbnN0cnVjdG9yICE9PSBPYmplY3QpIHtcclxuICAgICAgICBmb3IgKGxldCBuIGluIHRoaXMuX2tub253VHlwZXMpIHtcclxuICAgICAgICAgICAgbGV0IHYgPSB0aGlzLl9rbm9ud1R5cGVzW25dO1xyXG4gICAgICAgICAgICBpZiAodiA9PT0gb2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0T2JqW1NlcmlhbGl6ZXIuVFlQRVRBR10gPSBuO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuU2VyaWFsaXplci5wcm90b3R5cGUuX3NldFByb3RvID0gZnVuY3Rpb24gKG9iaiwgdHlwZVRhZykge1xyXG4gICAgdHlwZVRhZyA9IHR5cGVUYWcgfHwgb2JqW1NlcmlhbGl6ZXIuVFlQRVRBR107XHJcbiAgICBpZiAodHlwZVRhZykge1xyXG4gICAgICAgIGxldCB0eXBlID0gdGhpcy5fa25vbndUeXBlc1t0eXBlVGFnXTtcclxuICAgICAgICBpZiAoXy5pc1VuZGVmaW5lZCh0eXBlKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUeXBlICdcIiArIHR5cGVUYWcgKyBcIicgaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2Yob2JqLCB0eXBlKTtcclxuICAgICAgICBkZWxldGUgb2JqW1NlcmlhbGl6ZXIuVFlQRVRBR107XHJcbiAgICB9XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLnByb3RvdHlwZS5zdHJpbmdpZnkgPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICBsZXQganNvbiA9IHRoaXMudG9KU09OKG9iaik7XHJcbiAgICByZXR1cm4gXy5pc051bGwoanNvbikgPyBudWxsIDogSlNPTi5zdHJpbmdpZnkoanNvbik7XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChvYmopKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXJndW1lbnQgZXhwZWN0ZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKF8uaXNOdWxsKG9iaikpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuXHJcbiAgICByZXR1cm4gdGhpcy5fc2VyaWFsaXplKG9iaiwgbmV3IE1hcCgpLCBbXSk7XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLnByb3RvdHlwZS5fc2VyaWFsaXplID0gZnVuY3Rpb24gKG9iaiwgY2FjaGUsIHBhdGgpIHtcclxuICAgIGlmICh0eXBlb2Ygb2JqID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgY2FjaGUuc2V0KG9iaiwgcGF0aCk7XHJcblxyXG4gICAgICAgIGxldCB0b0pTT04gPSBmYWxzZTtcclxuICAgICAgICBsZXQgcE9iaiA9IG9iajtcclxuXHJcbiAgICAgICAgbGV0IHNlcmlhbGl6ZVRvSlNPTiA9IG9iai5zZXJpYWxpemVUb0pTT04gfHwgb2JqLl9zZXJpYWxpemVUb0pTT047XHJcbiAgICAgICAgaWYgKF8uaXNGdW5jdGlvbihzZXJpYWxpemVUb0pTT04pICYmIChfLmlzRnVuY3Rpb24ob2JqLmRlc2VyaWFsaXplRnJvbUpTT04pIHx8IF8uaXNGdW5jdGlvbihvYmouX2Rlc2VyaWFsaXplRnJvbUpTT04pKSkge1xyXG4gICAgICAgICAgICBvYmogPSBzZXJpYWxpemVUb0pTT04uY2FsbChvYmopO1xyXG4gICAgICAgICAgICBpZiAoIV8uaXNPYmplY3Qob2JqKSB8fCBfLmlzQXJyYXkob2JqKSkge1xyXG4gICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHBPYmouY29uc3RydWN0b3IubmFtZSArIFwiLnNlcmlhbGl6ZVRvSlNPTiBoYXMgcmV0dXJuZWQgbm90IGFuIG9iamVjdC5cIik7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgdG9KU09OID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBNYXApIHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSB7IGRhdGE6IFtdIH07XHJcbiAgICAgICAgICAgIGZvciAobGV0IGt2cCBvZiBvYmouZW50cmllcygpKSB7XHJcbiAgICAgICAgICAgICAgICBkYXRhLmRhdGEucHVzaChrdnApO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9iaiA9IGRhdGE7XHJcbiAgICAgICAgICAgIHRvSlNPTiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgU2V0KSB7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0geyBkYXRhOiBbXSB9O1xyXG4gICAgICAgICAgICBmb3IgKGxldCB2YWx1ZSBvZiBvYmoudmFsdWVzKCkpIHtcclxuICAgICAgICAgICAgICAgIGRhdGEuZGF0YS5wdXNoKHZhbHVlKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBvYmogPSBkYXRhO1xyXG4gICAgICAgICAgICB0b0pTT04gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgbGV0IG91dHB1dE9iaiA9IEFycmF5LmlzQXJyYXkob2JqKSA/IFtdIDoge307XHJcbiAgICAgICAgaWYgKHRvSlNPTikge1xyXG4gICAgICAgICAgICBvdXRwdXRPYmpbU2VyaWFsaXplci5UT0pTT05UQUddID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGZvciAobGV0IGtleSBpbiBvYmopIHtcclxuICAgICAgICAgICAgaWYgKG9iai5oYXNPd25Qcm9wZXJ0eShrZXkpKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgc3ViT2JqZWN0ID0gb2JqW2tleV07XHJcbiAgICAgICAgICAgICAgICBsZXQgdHlwZU9mU3ViT2JqZWN0ID0gdHlwZW9mIHN1Yk9iamVjdDtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlT2ZTdWJPYmplY3QgPT09IFwib2JqZWN0XCIgJiYgc3ViT2JqZWN0ICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGZvdW5kID0gZmFsc2U7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHN1Yk9iamVjdFBhdGggPSBjYWNoZS5nZXQoc3ViT2JqZWN0KTtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoIV8uaXNVbmRlZmluZWQoc3ViT2JqZWN0UGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IHBhdGhNYXJrZXIgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcGF0aE1hcmtlcltTZXJpYWxpemVyLkNJUkNVTEFSRkxBR10gPSBzdWJPYmplY3RQYXRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRPYmpba2V5XSA9IHBhdGhNYXJrZXI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvdW5kID0gdHJ1ZTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFmb3VuZCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgbmV3UGF0aCA9IHBhdGguc2xpY2UoMCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG5ld1BhdGgucHVzaChrZXkpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBvdXRwdXRPYmpba2V5XSA9IHRoaXMuX3NlcmlhbGl6ZShzdWJPYmplY3QsIGNhY2hlLCBuZXdQYXRoKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlT2ZTdWJPYmplY3QgPT09IFwiZnVuY3Rpb25cIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBmdW5jU3RyID0gc3ViT2JqZWN0LnRvU3RyaW5nKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKFNlcmlhbGl6ZXIuSVNOQVRJVkVGVU5DLnRlc3QoZnVuY1N0cikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHRoaXMub3B0aW9ucy5pZ25vcmVOYXRpdmVGdW5jKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmdW5jU3RyID0gXCJmdW5jdGlvbigpIHt0aHJvdyBuZXcgRXJyb3IoJ0NhbGwgYSBuYXRpdmUgZnVuY3Rpb24gdW5zZXJpYWxpemVkJyl9XCI7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJDYW4ndCBzZXJpYWxpemUgYSBvYmplY3Qgd2l0aCBhIG5hdGl2ZSBmdW5jdGlvbiBwcm9wZXJ0eS5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgb3V0cHV0T2JqW2tleV0gPSBTZXJpYWxpemVyLkZVTkNGTEFHICsgZnVuY1N0cjtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dE9ialtrZXldID0gc3ViT2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB0aGlzLl9zZXRUeXBlVGFnKG91dHB1dE9iaiwgcE9iaik7XHJcblxyXG4gICAgICAgIHJldHVybiBvdXRwdXRPYmo7XHJcbiAgICB9XHJcbiAgICBlbHNlIHtcclxuICAgICAgICByZXR1cm4gb2JqO1xyXG4gICAgfVxyXG59O1xyXG5cclxuU2VyaWFsaXplci5wcm90b3R5cGUucGFyc2UgPSBmdW5jdGlvbiAoc3RyKSB7XHJcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChzdHIpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXJndW1lbnQgZXhwZWN0ZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKF8uaXNOdWxsKHN0cikpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGlmICghXy5pc1N0cmluZyhzdHIpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50IGlzIG5vdCBhIHN0cmluZy5cIik7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuZnJvbUpTT04oSlNPTi5wYXJzZShzdHIpKTtcclxufTtcclxuXHJcblNlcmlhbGl6ZXIucHJvdG90eXBlLmZyb21KU09OID0gZnVuY3Rpb24gKGpzb24pIHtcclxuICAgIGlmIChfLmlzVW5kZWZpbmVkKGpzb24pKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXJndW1lbnQgZXhwZWN0ZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKF8uaXNOdWxsKGpzb24pKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcblxyXG4gICAgcmV0dXJuIHRoaXMuX3Vuc2VyaWFsaXplKGpzb24pO1xyXG59O1xyXG5cclxuU2VyaWFsaXplci5wcm90b3R5cGUuX3Vuc2VyaWFsaXplID0gZnVuY3Rpb24gKG9iaiwgb3JpZ2luT2JqLCBjaXJjdWxhclRhc2tzKSB7XHJcbiAgICBpZiAodHlwZW9mIG9iaiA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgIG9yaWdpbk9iaiA9IG9yaWdpbk9iaiB8fCBvYmo7XHJcbiAgICAgICAgY2lyY3VsYXJUYXNrcyA9IGNpcmN1bGFyVGFza3MgfHwgW107XHJcblxyXG4gICAgICAgIGxldCByZXN1bHQgPSBudWxsO1xyXG4gICAgICAgIGxldCBmcm9tSlNPTiA9IGZhbHNlO1xyXG4gICAgICAgIGlmIChvYmogIT09IG51bGwpIHtcclxuICAgICAgICAgICAgZnJvbUpTT04gPSBvYmpbU2VyaWFsaXplci5UT0pTT05UQUddID09PSB0cnVlO1xyXG4gICAgICAgICAgICByZXN1bHQgPSBBcnJheS5pc0FycmF5KG9iaikgPyBbXSA6IHt9O1xyXG4gICAgICAgICAgICBmb3IgKGxldCBrZXkgaW4gb2JqKSB7XHJcbiAgICAgICAgICAgICAgICBpZiAoa2V5ICE9PSBTZXJpYWxpemVyLlRPSlNPTlRBRykge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdWJPYmplY3QgPSBvYmpba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgdHlwZU9mU3ViT2JqID0gdHlwZW9mIHN1Yk9iamVjdDtcclxuICAgICAgICAgICAgICAgICAgICBpZiAodHlwZU9mU3ViT2JqID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBjaXJjUGF0aCA9IHN1Yk9iamVjdCAmJiBzdWJPYmplY3RbU2VyaWFsaXplci5DSVJDVUxBUkZMQUddO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAoQXJyYXkuaXNBcnJheShjaXJjUGF0aCkpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gY2lyY1BhdGg7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBjaXJjdWxhclRhc2tzLnB1c2goeyBvYmo6IHJlc3VsdCwga2V5OiBrZXkgfSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHRoaXMuX3Vuc2VyaWFsaXplKHN1Yk9iamVjdCwgb3JpZ2luT2JqLCBjaXJjdWxhclRhc2tzKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIGlmICh0eXBlT2ZTdWJPYmogPT09IFwic3RyaW5nXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHN1Yk9iamVjdC5pbmRleE9mKFNlcmlhbGl6ZXIuRlVOQ0ZMQUcpID09PSAwKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IGV2YWwoXCIoXCIgKyBzdWJPYmplY3Quc3Vic3RyaW5nKFNlcmlhbGl6ZXIuRlVOQ0ZMQUcubGVuZ3RoKSArIFwiKVwiKS5iaW5kKHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IHN1Yk9iamVjdDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBzdWJPYmplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob3JpZ2luT2JqID09PSBvYmopIHtcclxuICAgICAgICAgICAgY2lyY3VsYXJUYXNrcy5mb3JFYWNoKFxyXG4gICAgICAgICAgICAgICAgZnVuY3Rpb24gKHRhc2spIHtcclxuICAgICAgICAgICAgICAgICAgICB0YXNrLm9ialt0YXNrLmtleV0gPSBTZXJpYWxpemVyLl9nZXRLZXlQYXRoKHJlc3VsdCwgdGFzay5vYmpbdGFzay5rZXldKTtcclxuICAgICAgICAgICAgICAgIH0pO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHJlc3VsdCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICBpZiAoZnJvbUpTT04pIHtcclxuICAgICAgICAgICAgICAgIGxldCB0eXBlID0gcmVzdWx0W1NlcmlhbGl6ZXIuVFlQRVRBR107XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZSA9PT0gXCJNYXBcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBtYXAgPSBuZXcgTWFwKCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQga3ZwIG9mIHJlc3VsdC5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIG1hcC5zZXQoa3ZwWzBdLCBrdnBbMV0pO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbWFwO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gXCJTZXRcIikge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzZXQgPSBuZXcgU2V0KCk7XHJcbiAgICAgICAgICAgICAgICAgICAgZm9yIChsZXQgdmFsdWUgb2YgcmVzdWx0LmRhdGEpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2V0LmFkZCh2YWx1ZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBzZXQ7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgcmVhbFJlc3VsdCA9IHt9O1xyXG4gICAgICAgICAgICAgICAgICAgIHRoaXMuX3NldFByb3RvKHJlYWxSZXN1bHQsIHJlc3VsdFtTZXJpYWxpemVyLlRZUEVUQUddKTtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZGVzZXJpYWxpemVGcm9tSlNPTiA9IHJlYWxSZXN1bHQuZGVzZXJpYWxpemVGcm9tSlNPTiB8fCByZWFsUmVzdWx0Ll9kZXNlcmlhbGl6ZUZyb21KU09OO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChfLmlzRnVuY3Rpb24oZGVzZXJpYWxpemVGcm9tSlNPTikpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgZGVzZXJpYWxpemVGcm9tSlNPTi5jYWxsKHJlYWxSZXN1bHQsIHJlc3VsdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocmVzdWx0LmNvbnN0cnVjdG9yLm5hbWUgKyBcIi5kZXNlcmlhbGl6ZUZyb21KU09OIGZ1bmN0aW9uIG5vdCBmb3VuZC5cIik7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIHJldHVybiByZWFsUmVzdWx0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGVvZiByZXN1bHQgPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRQcm90byhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICByZXR1cm4gcmVzdWx0O1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG9iajtcclxuICAgIH1cclxufTtcclxuXHJcblNlcmlhbGl6ZXIuX2dldEtleVBhdGggPSBmdW5jdGlvbiAob3JpZ2luT2JqLCBwYXRoKSB7XHJcbiAgICBsZXQgY3VycmVudE9iaiA9IG9yaWdpbk9iajtcclxuICAgIHBhdGguZm9yRWFjaChcclxuICAgICAgICBmdW5jdGlvbiAocCwgaW5kZXgpIHtcclxuICAgICAgICAgICAgY3VycmVudE9iaiA9IGN1cnJlbnRPYmpbcF07XHJcbiAgICAgICAgfSk7XHJcbiAgICByZXR1cm4gY3VycmVudE9iajtcclxufTtcclxuXHJcblNlcmlhbGl6ZXIuRlVOQ0ZMQUcgPSBcIl8kJE5EX0ZVTkMkJF9cIjtcclxuU2VyaWFsaXplci5DSVJDVUxBUkZMQUcgPSBcIl8kJE5EX0NDJCRfXCI7XHJcblNlcmlhbGl6ZXIuVFlQRVRBRyA9IFwiXyQkVEFHX1RZUEUkJF9cIjtcclxuU2VyaWFsaXplci5UT0pTT05UQUcgPSBcIl8kJFRBR19UT0pTT04kJF9cIjtcclxuU2VyaWFsaXplci5JU05BVElWRUZVTkMgPSAvXmZ1bmN0aW9uXFxzKlteKF0qXFwoLipcXClcXHMqXFx7XFxzKlxcW25hdGl2ZSBjb2RlXFxdXFxzKlxcfSQvO1xyXG5cclxubW9kdWxlLmV4cG9ydHMgPSBTZXJpYWxpemVyOyJdfQ==
