"use strict";
var _ = require("lodash");
function Serializer(options) {
  this.options = {ignoreNativeFunc: true};
  if (options !== undefined) {
    _.extend(this.options, options);
  }
  this._knonwTypes = {};
  this._registerDefaultKnownTypes();
}
Serializer.prototype._registerDefaultKnownTypes = function() {
  this.registerKnownType("Map", Map);
  this.registerKnownType("Set", Set);
  this.registerKnownType("Date", Date);
  this.registerKnownType("RegExp", RegExp);
};
Serializer.prototype.registerKnownType = function(typeName, type) {
  if (!_.isString(typeName)) {
    throw new TypeError("Parameter 'alias' is not a string.");
  }
  if (!type) {
    throw new Error("Argument 'type' is expected.");
  }
  var typeOfType = typeof type;
  switch (typeOfType) {
    case "string":
      type = require(type);
      break;
    case "function":
      break;
    default:
      throw new TypeError("Argument 'type' value is unrecognised.");
  }
  if (_.isUndefined(type.prototype)) {
    throw new TypeError("Argument 'type' is not a constructor.");
  }
  this._knonwTypes[typeName] = type.prototype;
};
Serializer.prototype._setTypeTag = function(outputObj, obj) {
  if (obj.constructor && obj.constructor !== Object) {
    for (var n in this._knonwTypes) {
      var v = this._knonwTypes[n];
      if (v === obj.constructor.prototype) {
        outputObj[Serializer.TYPETAG] = n;
        return;
      }
    }
  }
};
Serializer.prototype._setProto = function(obj, typeTag) {
  typeTag = typeTag || obj[Serializer.TYPETAG];
  if (typeTag) {
    var type = this._knonwTypes[typeTag];
    if (_.isUndefined(type)) {
      throw new Error("Type '" + typeTag + "' has not been registered.");
    }
    Object.setPrototypeOf(obj, type);
    delete obj[Serializer.TYPETAG];
  }
};
Serializer.prototype.stringify = function(obj) {
  var json = this.toJSON(obj);
  return _.isNull(json) ? null : JSON.stringify(json);
};
Serializer.prototype.toJSON = function(obj) {
  if (_.isUndefined(obj)) {
    throw new Error("Argument expected.");
  }
  if (_.isNull(obj)) {
    return null;
  }
  if (_.isFunction(obj)) {
    obj = {f: obj};
    obj[Serializer.FUNCFLAG] = true;
  }
  return this._serialize(obj, new Map(), []);
};
Serializer.prototype._serialize = function(obj, cache, path) {
  if (typeof obj === "object") {
    cache.set(obj, path);
    var toJSON = false;
    var pObj = obj;
    var serializeToJSON = obj.serializeToJSON || obj._serializeToJSON;
    if (_.isFunction(serializeToJSON) && (_.isFunction(obj.deserializeFromJSON) || _.isFunction(obj._deserializeFromJSON))) {
      obj = serializeToJSON.call(obj);
      if (!_.isObject(obj) || _.isArray(obj)) {
        throw new Error(pObj.constructor.name + ".serializeToJSON has returned not an object.");
      }
      toJSON = true;
    }
    if (obj instanceof Map) {
      var data = {data: []};
      var $__4 = true;
      var $__5 = false;
      var $__6 = undefined;
      try {
        for (var $__2 = void 0,
            $__1 = (obj.entries())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
          var kvp = $__2.value;
          {
            data.data.push(kvp);
          }
        }
      } catch ($__7) {
        $__5 = true;
        $__6 = $__7;
      } finally {
        try {
          if (!$__4 && $__1.return != null) {
            $__1.return();
          }
        } finally {
          if ($__5) {
            throw $__6;
          }
        }
      }
      obj = data;
      toJSON = true;
    }
    if (obj instanceof Set) {
      var data$__15 = {data: []};
      var $__11 = true;
      var $__12 = false;
      var $__13 = undefined;
      try {
        for (var $__9 = void 0,
            $__8 = (obj.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__11 = ($__9 = $__8.next()).done); $__11 = true) {
          var value = $__9.value;
          {
            data$__15.data.push(value);
          }
        }
      } catch ($__14) {
        $__12 = true;
        $__13 = $__14;
      } finally {
        try {
          if (!$__11 && $__8.return != null) {
            $__8.return();
          }
        } finally {
          if ($__12) {
            throw $__13;
          }
        }
      }
      obj = data$__15;
      toJSON = true;
    }
    if (obj instanceof Date) {
      var data$__16 = {value: +obj};
      obj = data$__16;
      toJSON = true;
    }
    if (obj instanceof RegExp) {
      var source = obj.source;
      var data$__17 = {
        source: source,
        flags: obj.toString().substr(source.length + 2)
      };
      obj = data$__17;
      toJSON = true;
    }
    var outputObj = Array.isArray(obj) ? [] : {};
    if (toJSON) {
      outputObj[Serializer.TOJSONTAG] = true;
    }
    for (var key in obj) {
      if (obj.hasOwnProperty(key)) {
        var subObject = obj[key];
        var typeOfSubObject = typeof subObject;
        if (typeOfSubObject === "object" && subObject !== null) {
          var found = false;
          var subObjectPath = cache.get(subObject);
          if (!_.isUndefined(subObjectPath)) {
            var pathMarker = {};
            pathMarker[Serializer.CIRCULARFLAG] = subObjectPath;
            outputObj[key] = pathMarker;
            found = true;
          }
          if (!found) {
            var newPath = path.slice(0);
            newPath.push(key);
            outputObj[key] = this._serialize(subObject, cache, newPath);
          }
        } else if (typeOfSubObject === "function") {
          var funcStr = subObject.toString();
          if (Serializer.ISNATIVEFUNC.test(funcStr)) {
            if (this.options.ignoreNativeFunc) {
              funcStr = "function() {throw new Error('Call a native function unserialized')}";
            } else {
              throw new Error("Can't serialize a object with a native function property.");
            }
          }
          outputObj[key] = Serializer.FUNCFLAG + funcStr;
        } else {
          outputObj[key] = subObject;
        }
      }
    }
    this._setTypeTag(outputObj, pObj);
    return outputObj;
  } else {
    return obj;
  }
};
Serializer.prototype.parse = function(str) {
  if (_.isUndefined(str)) {
    throw new Error("Argument expected.");
  }
  if (_.isNull(str)) {
    return null;
  }
  if (!_.isString(str)) {
    throw new TypeError("Argument is not a string.");
  }
  return this.fromJSON(JSON.parse(str));
};
Serializer.prototype.fromJSON = function(json) {
  if (_.isUndefined(json)) {
    throw new Error("Argument expected.");
  }
  if (_.isNull(json)) {
    return null;
  }
  var fun = false;
  if (json && json[Serializer.FUNCFLAG]) {
    fun = true;
    json = {f: json.f};
  }
  var result = this._unserialize(json);
  if (fun) {
    result = result.f;
  }
  return result;
};
Serializer.prototype._unserialize = function(obj, originObj, circularTasks) {
  if (typeof obj === "object") {
    originObj = originObj || obj;
    circularTasks = circularTasks || [];
    var result = null;
    var fromJSON = false;
    if (obj !== null) {
      fromJSON = obj[Serializer.TOJSONTAG] === true;
      result = Array.isArray(obj) ? [] : {};
      for (var key in obj) {
        if (key !== Serializer.TOJSONTAG) {
          var subObject = obj[key];
          var typeOfSubObj = typeof subObject;
          if (typeOfSubObj === "object") {
            var circPath = subObject && subObject[Serializer.CIRCULARFLAG];
            if (Array.isArray(circPath)) {
              result[key] = circPath;
              circularTasks.push({
                obj: result,
                key: key
              });
            } else {
              result[key] = this._unserialize(subObject, originObj, circularTasks);
            }
          } else if (typeOfSubObj === "string") {
            if (subObject.indexOf(Serializer.FUNCFLAG) === 0) {
              result[key] = eval("(" + subObject.substring(Serializer.FUNCFLAG.length) + ")").bind(result);
            } else {
              result[key] = subObject;
            }
          } else {
            result[key] = subObject;
          }
        }
      }
    }
    if (originObj === obj) {
      circularTasks.forEach(function(task) {
        task.obj[task.key] = Serializer._getKeyPath(result, task.obj[task.key]);
      });
    }
    if (result !== null) {
      if (fromJSON) {
        var type = result[Serializer.TYPETAG];
        if (type === "Map") {
          var map = new Map();
          var $__4 = true;
          var $__5 = false;
          var $__6 = undefined;
          try {
            for (var $__2 = void 0,
                $__1 = (result.data)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
              var kvp = $__2.value;
              {
                map.set(kvp[0], kvp[1]);
              }
            }
          } catch ($__7) {
            $__5 = true;
            $__6 = $__7;
          } finally {
            try {
              if (!$__4 && $__1.return != null) {
                $__1.return();
              }
            } finally {
              if ($__5) {
                throw $__6;
              }
            }
          }
          return map;
        } else if (type === "Set") {
          var set = new Set();
          var $__11 = true;
          var $__12 = false;
          var $__13 = undefined;
          try {
            for (var $__9 = void 0,
                $__8 = (result.data)[$traceurRuntime.toProperty(Symbol.iterator)](); !($__11 = ($__9 = $__8.next()).done); $__11 = true) {
              var value = $__9.value;
              {
                set.add(value);
              }
            }
          } catch ($__14) {
            $__12 = true;
            $__13 = $__14;
          } finally {
            try {
              if (!$__11 && $__8.return != null) {
                $__8.return();
              }
            } finally {
              if ($__12) {
                throw $__13;
              }
            }
          }
          return set;
        } else if (type === "Date") {
          return new Date(result.value);
        } else if (type === "RegExp") {
          return new RegExp(result.source, result.flags);
        } else {
          var realResult = {};
          this._setProto(realResult, result[Serializer.TYPETAG]);
          var deserializeFromJSON = realResult.deserializeFromJSON || realResult._deserializeFromJSON;
          if (_.isFunction(deserializeFromJSON)) {
            deserializeFromJSON.call(realResult, result);
          } else {
            throw new Error(result.constructor.name + ".deserializeFromJSON function not found.");
          }
          return realResult;
        }
      } else {
        if (typeof result === "object") {
          this._setProto(result);
        }
      }
    }
    return result;
  } else {
    return obj;
  }
};
Serializer._getKeyPath = function(originObj, path) {
  var currentObj = originObj;
  path.forEach(function(p, index) {
    currentObj = currentObj[p];
  });
  return currentObj;
};
Serializer.FUNCFLAG = "_$$ND_FUNC$$_";
Serializer.CIRCULARFLAG = "_$$ND_CC$$_";
Serializer.TYPETAG = "_$$TAG_TYPE$$_";
Serializer.TOJSONTAG = "_$$TAG_TOJSON$$_";
Serializer.ISNATIVEFUNC = /^function\s*[^(]*\(.*\)\s*\{\s*\[native code\]\s*\}$/;
module.exports = Serializer;
//# sourceMappingURL=data:application/json;base64,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QztBQUNyQyxTQUFTLFVBQVUsRUFBSSxtQkFBaUIsQ0FBQztBQUN6QyxTQUFTLGFBQWEsRUFBSSx1REFBcUQsQ0FBQztBQUVoRixLQUFLLFFBQVEsRUFBSSxXQUFTLENBQUM7QUFBQSIsImZpbGUiOiJzeXN0ZW0vc2VyaWFsaXplci5qcyIsInNvdXJjZVJvb3QiOiJsaWIvZXM2Iiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XHJcblxyXG4vKiBqc2hpbnQgLVcwNjEgKi9cclxuXHJcbmxldCBfID0gcmVxdWlyZShcImxvZGFzaFwiKTtcclxuXHJcbmZ1bmN0aW9uIFNlcmlhbGl6ZXIob3B0aW9ucykge1xyXG4gICAgdGhpcy5vcHRpb25zID0ge1xyXG4gICAgICAgIGlnbm9yZU5hdGl2ZUZ1bmM6IHRydWVcclxuICAgIH07XHJcbiAgICBpZiAob3B0aW9ucyAhPT0gdW5kZWZpbmVkKSB7XHJcbiAgICAgICAgXy5leHRlbmQodGhpcy5vcHRpb25zLCBvcHRpb25zKTtcclxuICAgIH1cclxuICAgIHRoaXMuX2tub253VHlwZXMgPSB7fTtcclxuICAgIHRoaXMuX3JlZ2lzdGVyRGVmYXVsdEtub3duVHlwZXMoKTtcclxufVxyXG5cclxuU2VyaWFsaXplci5wcm90b3R5cGUuX3JlZ2lzdGVyRGVmYXVsdEtub3duVHlwZXMgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICB0aGlzLnJlZ2lzdGVyS25vd25UeXBlKFwiTWFwXCIsIE1hcCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyS25vd25UeXBlKFwiU2V0XCIsIFNldCk7XHJcbiAgICB0aGlzLnJlZ2lzdGVyS25vd25UeXBlKFwiRGF0ZVwiLCBEYXRlKTtcclxuICAgIHRoaXMucmVnaXN0ZXJLbm93blR5cGUoXCJSZWdFeHBcIiwgUmVnRXhwKTtcclxufTtcclxuXHJcblNlcmlhbGl6ZXIucHJvdG90eXBlLnJlZ2lzdGVyS25vd25UeXBlID0gZnVuY3Rpb24gKHR5cGVOYW1lLCB0eXBlKSB7XHJcbiAgICBpZiAoIV8uaXNTdHJpbmcodHlwZU5hbWUpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIlBhcmFtZXRlciAnYWxpYXMnIGlzIG5vdCBhIHN0cmluZy5cIik7XHJcbiAgICB9XHJcbiAgICBpZiAoIXR5cGUpIHtcclxuICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJBcmd1bWVudCAndHlwZScgaXMgZXhwZWN0ZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgbGV0IHR5cGVPZlR5cGUgPSB0eXBlb2YgdHlwZTtcclxuICAgIHN3aXRjaCAodHlwZU9mVHlwZSkge1xyXG4gICAgICAgIGNhc2UgXCJzdHJpbmdcIjpcclxuICAgICAgICAgICAgdHlwZSA9IHJlcXVpcmUodHlwZSk7XHJcbiAgICAgICAgICAgIGJyZWFrO1xyXG4gICAgICAgIGNhc2UgXCJmdW5jdGlvblwiOlxyXG4gICAgICAgICAgICBicmVhaztcclxuICAgICAgICBkZWZhdWx0IDpcclxuICAgICAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICd0eXBlJyB2YWx1ZSBpcyB1bnJlY29nbmlzZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKF8uaXNVbmRlZmluZWQodHlwZS5wcm90b3R5cGUpKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IFR5cGVFcnJvcihcIkFyZ3VtZW50ICd0eXBlJyBpcyBub3QgYSBjb25zdHJ1Y3Rvci5cIik7XHJcbiAgICB9XHJcbiAgICB0aGlzLl9rbm9ud1R5cGVzW3R5cGVOYW1lXSA9IHR5cGUucHJvdG90eXBlO1xyXG59O1xyXG5cclxuU2VyaWFsaXplci5wcm90b3R5cGUuX3NldFR5cGVUYWcgPSBmdW5jdGlvbiAob3V0cHV0T2JqLCBvYmopIHtcclxuICAgIGlmIChvYmouY29uc3RydWN0b3IgJiYgb2JqLmNvbnN0cnVjdG9yICE9PSBPYmplY3QpIHtcclxuICAgICAgICBmb3IgKGxldCBuIGluIHRoaXMuX2tub253VHlwZXMpIHtcclxuICAgICAgICAgICAgbGV0IHYgPSB0aGlzLl9rbm9ud1R5cGVzW25dO1xyXG4gICAgICAgICAgICBpZiAodiA9PT0gb2JqLmNvbnN0cnVjdG9yLnByb3RvdHlwZSkge1xyXG4gICAgICAgICAgICAgICAgb3V0cHV0T2JqW1NlcmlhbGl6ZXIuVFlQRVRBR10gPSBuO1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG59O1xyXG5cclxuU2VyaWFsaXplci5wcm90b3R5cGUuX3NldFByb3RvID0gZnVuY3Rpb24gKG9iaiwgdHlwZVRhZykge1xyXG4gICAgdHlwZVRhZyA9IHR5cGVUYWcgfHwgb2JqW1NlcmlhbGl6ZXIuVFlQRVRBR107XHJcbiAgICBpZiAodHlwZVRhZykge1xyXG4gICAgICAgIGxldCB0eXBlID0gdGhpcy5fa25vbndUeXBlc1t0eXBlVGFnXTtcclxuICAgICAgICBpZiAoXy5pc1VuZGVmaW5lZCh0eXBlKSkge1xyXG4gICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IoXCJUeXBlICdcIiArIHR5cGVUYWcgKyBcIicgaGFzIG5vdCBiZWVuIHJlZ2lzdGVyZWQuXCIpO1xyXG4gICAgICAgIH1cclxuICAgICAgICBPYmplY3Quc2V0UHJvdG90eXBlT2Yob2JqLCB0eXBlKTtcclxuICAgICAgICBkZWxldGUgb2JqW1NlcmlhbGl6ZXIuVFlQRVRBR107XHJcbiAgICB9XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLnByb3RvdHlwZS5zdHJpbmdpZnkgPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICBsZXQganNvbiA9IHRoaXMudG9KU09OKG9iaik7XHJcbiAgICByZXR1cm4gXy5pc051bGwoanNvbikgPyBudWxsIDogSlNPTi5zdHJpbmdpZnkoanNvbik7XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLnByb3RvdHlwZS50b0pTT04gPSBmdW5jdGlvbiAob2JqKSB7XHJcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChvYmopKSB7XHJcbiAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQXJndW1lbnQgZXhwZWN0ZWQuXCIpO1xyXG4gICAgfVxyXG4gICAgaWYgKF8uaXNOdWxsKG9iaikpIHtcclxuICAgICAgICByZXR1cm4gbnVsbDtcclxuICAgIH1cclxuICAgIGlmIChfLmlzRnVuY3Rpb24ob2JqKSkge1xyXG4gICAgICAgIG9iaiA9IHtcclxuICAgICAgICAgICAgZjogb2JqXHJcbiAgICAgICAgfTtcclxuICAgICAgICBvYmpbU2VyaWFsaXplci5GVU5DRkxBR10gPSB0cnVlO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLl9zZXJpYWxpemUob2JqLCBuZXcgTWFwKCksIFtdKTtcclxufTtcclxuXHJcblNlcmlhbGl6ZXIucHJvdG90eXBlLl9zZXJpYWxpemUgPSBmdW5jdGlvbiAob2JqLCBjYWNoZSwgcGF0aCkge1xyXG4gICAgaWYgKHR5cGVvZiBvYmogPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICBjYWNoZS5zZXQob2JqLCBwYXRoKTtcclxuXHJcbiAgICAgICAgbGV0IHRvSlNPTiA9IGZhbHNlO1xyXG4gICAgICAgIGxldCBwT2JqID0gb2JqO1xyXG5cclxuICAgICAgICBsZXQgc2VyaWFsaXplVG9KU09OID0gb2JqLnNlcmlhbGl6ZVRvSlNPTiB8fCBvYmouX3NlcmlhbGl6ZVRvSlNPTjtcclxuICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKHNlcmlhbGl6ZVRvSlNPTikgJiYgKF8uaXNGdW5jdGlvbihvYmouZGVzZXJpYWxpemVGcm9tSlNPTikgfHwgXy5pc0Z1bmN0aW9uKG9iai5fZGVzZXJpYWxpemVGcm9tSlNPTikpKSB7XHJcbiAgICAgICAgICAgIG9iaiA9IHNlcmlhbGl6ZVRvSlNPTi5jYWxsKG9iaik7XHJcbiAgICAgICAgICAgIGlmICghXy5pc09iamVjdChvYmopIHx8IF8uaXNBcnJheShvYmopKSB7XHJcbiAgICAgICAgICAgICAgICB0aHJvdyBuZXcgRXJyb3IocE9iai5jb25zdHJ1Y3Rvci5uYW1lICsgXCIuc2VyaWFsaXplVG9KU09OIGhhcyByZXR1cm5lZCBub3QgYW4gb2JqZWN0LlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICB0b0pTT04gPSB0cnVlO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9iaiBpbnN0YW5jZW9mIE1hcCkge1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHsgZGF0YTogW10gfTtcclxuICAgICAgICAgICAgZm9yIChsZXQga3ZwIG9mIG9iai5lbnRyaWVzKCkpIHtcclxuICAgICAgICAgICAgICAgIGRhdGEuZGF0YS5wdXNoKGt2cCk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgb2JqID0gZGF0YTtcclxuICAgICAgICAgICAgdG9KU09OID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBTZXQpIHtcclxuICAgICAgICAgICAgbGV0IGRhdGEgPSB7IGRhdGE6IFtdIH07XHJcbiAgICAgICAgICAgIGZvciAobGV0IHZhbHVlIG9mIG9iai52YWx1ZXMoKSkge1xyXG4gICAgICAgICAgICAgICAgZGF0YS5kYXRhLnB1c2godmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIG9iaiA9IGRhdGE7XHJcbiAgICAgICAgICAgIHRvSlNPTiA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAob2JqIGluc3RhbmNlb2YgRGF0ZSkge1xyXG4gICAgICAgICAgICBsZXQgZGF0YSA9IHsgdmFsdWU6ICtvYmogfTtcclxuICAgICAgICAgICAgb2JqID0gZGF0YTtcclxuICAgICAgICAgICAgdG9KU09OID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChvYmogaW5zdGFuY2VvZiBSZWdFeHApIHtcclxuICAgICAgICAgICAgbGV0IHNvdXJjZSA9IG9iai5zb3VyY2U7XHJcbiAgICAgICAgICAgIGxldCBkYXRhID0geyBzb3VyY2U6IHNvdXJjZSwgZmxhZ3M6IG9iai50b1N0cmluZygpLnN1YnN0cihzb3VyY2UubGVuZ3RoICsgMikgfTtcclxuICAgICAgICAgICAgb2JqID0gZGF0YTtcclxuICAgICAgICAgICAgdG9KU09OID0gdHJ1ZTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGxldCBvdXRwdXRPYmogPSBBcnJheS5pc0FycmF5KG9iaikgPyBbXSA6IHt9O1xyXG4gICAgICAgIGlmICh0b0pTT04pIHtcclxuICAgICAgICAgICAgb3V0cHV0T2JqW1NlcmlhbGl6ZXIuVE9KU09OVEFHXSA9IHRydWU7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBmb3IgKGxldCBrZXkgaW4gb2JqKSB7XHJcbiAgICAgICAgICAgIGlmIChvYmouaGFzT3duUHJvcGVydHkoa2V5KSkge1xyXG4gICAgICAgICAgICAgICAgbGV0IHN1Yk9iamVjdCA9IG9ialtrZXldO1xyXG4gICAgICAgICAgICAgICAgbGV0IHR5cGVPZlN1Yk9iamVjdCA9IHR5cGVvZiBzdWJPYmplY3Q7XHJcbiAgICAgICAgICAgICAgICBpZiAodHlwZU9mU3ViT2JqZWN0ID09PSBcIm9iamVjdFwiICYmIHN1Yk9iamVjdCAhPT0gbnVsbCkge1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBmb3VuZCA9IGZhbHNlO1xyXG4gICAgICAgICAgICAgICAgICAgIGxldCBzdWJPYmplY3RQYXRoID0gY2FjaGUuZ2V0KHN1Yk9iamVjdCk7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKCFfLmlzVW5kZWZpbmVkKHN1Yk9iamVjdFBhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGxldCBwYXRoTWFya2VyID0ge307XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHBhdGhNYXJrZXJbU2VyaWFsaXplci5DSVJDVUxBUkZMQUddID0gc3ViT2JqZWN0UGF0aDtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0T2JqW2tleV0gPSBwYXRoTWFya2VyO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3VuZCA9IHRydWU7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIGlmICghZm91bmQpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgbGV0IG5ld1BhdGggPSBwYXRoLnNsaWNlKDApO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBuZXdQYXRoLnB1c2goa2V5KTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgb3V0cHV0T2JqW2tleV0gPSB0aGlzLl9zZXJpYWxpemUoc3ViT2JqZWN0LCBjYWNoZSwgbmV3UGF0aCk7XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZU9mU3ViT2JqZWN0ID09PSBcImZ1bmN0aW9uXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgZnVuY1N0ciA9IHN1Yk9iamVjdC50b1N0cmluZygpO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmIChTZXJpYWxpemVyLklTTkFUSVZFRlVOQy50ZXN0KGZ1bmNTdHIpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmICh0aGlzLm9wdGlvbnMuaWdub3JlTmF0aXZlRnVuYykge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZnVuY1N0ciA9IFwiZnVuY3Rpb24oKSB7dGhyb3cgbmV3IEVycm9yKCdDYWxsIGEgbmF0aXZlIGZ1bmN0aW9uIHVuc2VyaWFsaXplZCcpfVwiO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKFwiQ2FuJ3Qgc2VyaWFsaXplIGEgb2JqZWN0IHdpdGggYSBuYXRpdmUgZnVuY3Rpb24gcHJvcGVydHkuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgICAgIG91dHB1dE9ialtrZXldID0gU2VyaWFsaXplci5GVU5DRkxBRyArIGZ1bmNTdHI7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICBvdXRwdXRPYmpba2V5XSA9IHN1Yk9iamVjdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdGhpcy5fc2V0VHlwZVRhZyhvdXRwdXRPYmosIHBPYmopO1xyXG5cclxuICAgICAgICByZXR1cm4gb3V0cHV0T2JqO1xyXG4gICAgfVxyXG4gICAgZWxzZSB7XHJcbiAgICAgICAgcmV0dXJuIG9iajtcclxuICAgIH1cclxufTtcclxuXHJcblNlcmlhbGl6ZXIucHJvdG90eXBlLnBhcnNlID0gZnVuY3Rpb24gKHN0cikge1xyXG4gICAgaWYgKF8uaXNVbmRlZmluZWQoc3RyKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFyZ3VtZW50IGV4cGVjdGVkLlwiKTtcclxuICAgIH1cclxuICAgIGlmIChfLmlzTnVsbChzdHIpKSB7XHJcbiAgICAgICAgcmV0dXJuIG51bGw7XHJcbiAgICB9XHJcbiAgICBpZiAoIV8uaXNTdHJpbmcoc3RyKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBUeXBlRXJyb3IoXCJBcmd1bWVudCBpcyBub3QgYSBzdHJpbmcuXCIpO1xyXG4gICAgfVxyXG5cclxuICAgIHJldHVybiB0aGlzLmZyb21KU09OKEpTT04ucGFyc2Uoc3RyKSk7XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLnByb3RvdHlwZS5mcm9tSlNPTiA9IGZ1bmN0aW9uIChqc29uKSB7XHJcbiAgICBpZiAoXy5pc1VuZGVmaW5lZChqc29uKSkge1xyXG4gICAgICAgIHRocm93IG5ldyBFcnJvcihcIkFyZ3VtZW50IGV4cGVjdGVkLlwiKTtcclxuICAgIH1cclxuICAgIGlmIChfLmlzTnVsbChqc29uKSkge1xyXG4gICAgICAgIHJldHVybiBudWxsO1xyXG4gICAgfVxyXG4gICAgbGV0IGZ1biA9IGZhbHNlO1xyXG4gICAgaWYgKGpzb24gJiYganNvbltTZXJpYWxpemVyLkZVTkNGTEFHXSkge1xyXG4gICAgICAgIGZ1biA9IHRydWU7XHJcbiAgICAgICAganNvbiA9IHsgZjoganNvbi5mIH07XHJcbiAgICB9XHJcblxyXG4gICAgbGV0IHJlc3VsdCA9IHRoaXMuX3Vuc2VyaWFsaXplKGpzb24pO1xyXG4gICAgaWYgKGZ1bikge1xyXG4gICAgICAgIHJlc3VsdCA9IHJlc3VsdC5mO1xyXG4gICAgfVxyXG4gICAgcmV0dXJuIHJlc3VsdDtcclxufTtcclxuXHJcblNlcmlhbGl6ZXIucHJvdG90eXBlLl91bnNlcmlhbGl6ZSA9IGZ1bmN0aW9uIChvYmosIG9yaWdpbk9iaiwgY2lyY3VsYXJUYXNrcykge1xyXG4gICAgaWYgKHR5cGVvZiBvYmogPT09IFwib2JqZWN0XCIpIHtcclxuICAgICAgICBvcmlnaW5PYmogPSBvcmlnaW5PYmogfHwgb2JqO1xyXG4gICAgICAgIGNpcmN1bGFyVGFza3MgPSBjaXJjdWxhclRhc2tzIHx8IFtdO1xyXG5cclxuICAgICAgICBsZXQgcmVzdWx0ID0gbnVsbDtcclxuICAgICAgICBsZXQgZnJvbUpTT04gPSBmYWxzZTtcclxuICAgICAgICBpZiAob2JqICE9PSBudWxsKSB7XHJcbiAgICAgICAgICAgIGZyb21KU09OID0gb2JqW1NlcmlhbGl6ZXIuVE9KU09OVEFHXSA9PT0gdHJ1ZTtcclxuICAgICAgICAgICAgcmVzdWx0ID0gQXJyYXkuaXNBcnJheShvYmopID8gW10gOiB7fTtcclxuICAgICAgICAgICAgZm9yIChsZXQga2V5IGluIG9iaikge1xyXG4gICAgICAgICAgICAgICAgaWYgKGtleSAhPT0gU2VyaWFsaXplci5UT0pTT05UQUcpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc3ViT2JqZWN0ID0gb2JqW2tleV07XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHR5cGVPZlN1Yk9iaiA9IHR5cGVvZiBzdWJPYmplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgaWYgKHR5cGVPZlN1Yk9iaiA9PT0gXCJvYmplY3RcIikge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBsZXQgY2lyY1BhdGggPSBzdWJPYmplY3QgJiYgc3ViT2JqZWN0W1NlcmlhbGl6ZXIuQ0lSQ1VMQVJGTEFHXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKEFycmF5LmlzQXJyYXkoY2lyY1BhdGgpKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXN1bHRba2V5XSA9IGNpcmNQYXRoO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2lyY3VsYXJUYXNrcy5wdXNoKHsgb2JqOiByZXN1bHQsIGtleToga2V5IH0pO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSB0aGlzLl91bnNlcmlhbGl6ZShzdWJPYmplY3QsIG9yaWdpbk9iaiwgY2lyY3VsYXJUYXNrcyk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZU9mU3ViT2JqID09PSBcInN0cmluZ1wiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmIChzdWJPYmplY3QuaW5kZXhPZihTZXJpYWxpemVyLkZVTkNGTEFHKSA9PT0gMCkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBldmFsKFwiKFwiICsgc3ViT2JqZWN0LnN1YnN0cmluZyhTZXJpYWxpemVyLkZVTkNGTEFHLmxlbmd0aCkgKyBcIilcIikuYmluZChyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmVzdWx0W2tleV0gPSBzdWJPYmplY3Q7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHJlc3VsdFtrZXldID0gc3ViT2JqZWN0O1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKG9yaWdpbk9iaiA9PT0gb2JqKSB7XHJcbiAgICAgICAgICAgIGNpcmN1bGFyVGFza3MuZm9yRWFjaChcclxuICAgICAgICAgICAgICAgIGZ1bmN0aW9uICh0YXNrKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGFzay5vYmpbdGFzay5rZXldID0gU2VyaWFsaXplci5fZ2V0S2V5UGF0aChyZXN1bHQsIHRhc2sub2JqW3Rhc2sua2V5XSk7XHJcbiAgICAgICAgICAgICAgICB9KTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChyZXN1bHQgIT09IG51bGwpIHtcclxuICAgICAgICAgICAgaWYgKGZyb21KU09OKSB7XHJcbiAgICAgICAgICAgICAgICBsZXQgdHlwZSA9IHJlc3VsdFtTZXJpYWxpemVyLlRZUEVUQUddO1xyXG4gICAgICAgICAgICAgICAgaWYgKHR5cGUgPT09IFwiTWFwXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgbWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IGt2cCBvZiByZXN1bHQuZGF0YSkge1xyXG4gICAgICAgICAgICAgICAgICAgICAgICBtYXAuc2V0KGt2cFswXSwga3ZwWzFdKTtcclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgcmV0dXJuIG1hcDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09IFwiU2V0XCIpIHtcclxuICAgICAgICAgICAgICAgICAgICBsZXQgc2V0ID0gbmV3IFNldCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIGZvciAobGV0IHZhbHVlIG9mIHJlc3VsdC5kYXRhKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHNldC5hZGQodmFsdWUpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gc2V0O1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSBpZiAodHlwZSA9PT0gXCJEYXRlXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IERhdGUocmVzdWx0LnZhbHVlKTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIGVsc2UgaWYgKHR5cGUgPT09IFwiUmVnRXhwXCIpIHtcclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gbmV3IFJlZ0V4cChyZXN1bHQuc291cmNlLCByZXN1bHQuZmxhZ3MpO1xyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IHJlYWxSZXN1bHQgPSB7fTtcclxuICAgICAgICAgICAgICAgICAgICB0aGlzLl9zZXRQcm90byhyZWFsUmVzdWx0LCByZXN1bHRbU2VyaWFsaXplci5UWVBFVEFHXSk7XHJcbiAgICAgICAgICAgICAgICAgICAgbGV0IGRlc2VyaWFsaXplRnJvbUpTT04gPSByZWFsUmVzdWx0LmRlc2VyaWFsaXplRnJvbUpTT04gfHwgcmVhbFJlc3VsdC5fZGVzZXJpYWxpemVGcm9tSlNPTjtcclxuICAgICAgICAgICAgICAgICAgICBpZiAoXy5pc0Z1bmN0aW9uKGRlc2VyaWFsaXplRnJvbUpTT04pKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGRlc2VyaWFsaXplRnJvbUpTT04uY2FsbChyZWFsUmVzdWx0LCByZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgdGhyb3cgbmV3IEVycm9yKHJlc3VsdC5jb25zdHJ1Y3Rvci5uYW1lICsgXCIuZGVzZXJpYWxpemVGcm9tSlNPTiBmdW5jdGlvbiBub3QgZm91bmQuXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICByZXR1cm4gcmVhbFJlc3VsdDtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICBlbHNlIHtcclxuICAgICAgICAgICAgICAgIGlmICh0eXBlb2YgcmVzdWx0ID09PSBcIm9iamVjdFwiKSB7XHJcbiAgICAgICAgICAgICAgICAgICAgdGhpcy5fc2V0UHJvdG8ocmVzdWx0KTtcclxuICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgcmV0dXJuIHJlc3VsdDtcclxuICAgIH1cclxuICAgIGVsc2Uge1xyXG4gICAgICAgIHJldHVybiBvYmo7XHJcbiAgICB9XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLl9nZXRLZXlQYXRoID0gZnVuY3Rpb24gKG9yaWdpbk9iaiwgcGF0aCkge1xyXG4gICAgbGV0IGN1cnJlbnRPYmogPSBvcmlnaW5PYmo7XHJcbiAgICBwYXRoLmZvckVhY2goXHJcbiAgICAgICAgZnVuY3Rpb24gKHAsIGluZGV4KSB7XHJcbiAgICAgICAgICAgIGN1cnJlbnRPYmogPSBjdXJyZW50T2JqW3BdO1xyXG4gICAgICAgIH0pO1xyXG4gICAgcmV0dXJuIGN1cnJlbnRPYmo7XHJcbn07XHJcblxyXG5TZXJpYWxpemVyLkZVTkNGTEFHID0gXCJfJCRORF9GVU5DJCRfXCI7XHJcblNlcmlhbGl6ZXIuQ0lSQ1VMQVJGTEFHID0gXCJfJCRORF9DQyQkX1wiO1xyXG5TZXJpYWxpemVyLlRZUEVUQUcgPSBcIl8kJFRBR19UWVBFJCRfXCI7XHJcblNlcmlhbGl6ZXIuVE9KU09OVEFHID0gXCJfJCRUQUdfVE9KU09OJCRfXCI7XHJcblNlcmlhbGl6ZXIuSVNOQVRJVkVGVU5DID0gL15mdW5jdGlvblxccypbXihdKlxcKC4qXFwpXFxzKlxce1xccypcXFtuYXRpdmUgY29kZVxcXVxccypcXH0kLztcclxuXHJcbm1vZHVsZS5leHBvcnRzID0gU2VyaWFsaXplcjsiXX0=
