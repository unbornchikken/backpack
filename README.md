# Backpack (MIT)

![Backpack](http://4.bp.blogspot.com/-HWzrWGNMwGA/T9adhLWLaZI/AAAAAAAADsY/2TRrMuYUMWM/s1600/acw_how-to-draw-backpack-from-dora-the-explorer-tutorial-drawing.jpeg)

Class library of useful things for Node.js

## Purpose

The aim of this library is to provide a collection of classes in one place like those can be found in other frameworks, 
but are not bundled in Node.js, even are not exists on the npm.org.

## Collections

Hashed collections are missing from JavaScript. You can create an object, and then put it some other objects keyed by string values, but that's it,
 you cannot use keys other than strings.

There are some already implemented solutions for this, like: [hashmap](https://www.npmjs.org/package/hashmap) or [hashtable](https://www.npmjs.org/package/hashtable).
The problem is those are either native libraries which often banned from mayor cloud platforms, or if implemented in pure JS they will mutate keys which 
[seriously hurts V8 performance optimizations](http://www.html5rocks.com/en/tutorials/speed/v8/).

Backpack is a pure JS module and Backpack Collections **won't mutate keys**, yet you can use *any* object for keys in classes where appropriate.
Keys are generated by:

- using object's toString() method if overridden
- using object's getMapKey() or \_getMapKey() method if defined
- otherwise keys are generated from combining object field's names and values.

For example:

```javascript

var Map = require("backpack").collections.Map;

var id = 0;
function MyObject()
{
    this.id = id++;
}
MyObject.prototype.toString = function()
{
    return this.id; 
}

var myObject = new MyObject();
var key = Map._genKey(myObject);
console.log(key);
// Result: 0;

function MyOtherObject()
{
    this.id = id++;
}
MyOtherObject.prototype.getMapKey = function()
{
    return this.id; 
}

myOtherObject = new MyOtherObject();
key = Map._genKey(myOtherObject);
console.log(key);
// Result: 1;

var obj = { a: "foo", b: new MyObject(), c: new MyOtherObject() };
key = Map._genKey(obj);
console.log(key);
// Result: afoob2c3;
```

The key's equality will be determined by:
- using the equals() or \_equals() method if defined
- using the strict equality operator otherwise

### Map

#### Usage:

```javascript
var Map = require("backpack").collections.Map;
var myMap = new Map();
myMap.add(1, "a");
```

#### Reference:

*Properties:*

- **count** 
    
    Returns the items count.

*Methods:*

- **add** (key, value)

    Adds an item to the map. It will throw if item is already exists.

- **set** (key, value, throwIfExists)

    Adds and item to the map. It will throw if item is already exists when 'throwIfExists' argument is true, item will be overwritten otherwise.

- **get** (key)

    Returns item by key. 
    
    If it hasn't found the result will be *undefined*.

- **remove** (key)

    Removes item by key. 
    
    If it's found and successfully removed result will be *true*, if not found result will be *false*.

- **containsKey** (key)

    If item's found by key result will be *true*, if has not found result will be *false*.

- **clear** ()

    Clears the map.

- **forEach** (f)

    The function argument will be called for each item.
    
    Example:
    
    ```javascript
    var myMap = new Map();
    myMap.add(1, "a");
    myMap.add(2, "b");
    myMap.forEach(function (item)
    {
        console.log("Key: " + item.key);
        console.log("Value: " + item.value);
    });
    // output will be:
    // Key: 1
    // Value: a
    // Key: 2
    // Value: b
    ```

- **forEachKey** (f)

    The function argument will be called for each key.
    
    Example:
    
    ```javascript
    var myMap = new Map();
    myMap.add(1, "a");
    myMap.add(2, "b");
    myMap.forEachKey(function (key)
    {
        console.log("Key: " + key);
    });
    // output will be:
    // Key: 1
    // Key: 2
    ```

- **forEachValue** (f)

    The function argument will be called for each value.
        
    Example:
    
    ```javascript
    var myMap = new Map();
    myMap.add(1, "a");
    myMap.add(2, "b");
    myMap.forEachValue(function (value)
    {
        console.log("Value: " + value);
    });
    // output will be:
    // Value: a
    // Value: b
    ```

### StrMap

This class has exactly the same interface like the Map, but keys have to be strings only. Basically it's a wrapper around a standard object extended by a count property.

#### Usage:

```javascript
var StrMap = require("backpack").collections.StrMap;
var myMap = new StrMap();
myMap.add("42", new Date().now());
```

## Set

### Usage:

```javascript
var Set = require("backpack").collections.Set;
var mySet = new Set();
mySet.add(5);
mySet.add("bubu");
```

#### Reference:

*Properties:*

- **count** 
    
    Returns the items count.

*Methods:*

- **add** (value)

    Adds item to the set.
    
    If item's added it returns *true*, if item's already existed it returns *false*.
    
- **remove** (value)

    Removes item from the set.
    
    If item's existed and has removed it returns *true*, if item hasn't existed it returns *false*.

- **clear** ()

    Clears the set.

- **exists** (value)

    Returns *true* if item exists, *false* otherwise.

- **forEach** (f)

    The function argument will be called for each value.
        
    Example:
    
    ```javascript
    var mySet = new Set();
    mySet.add("a");
    mySet.add("b");
    mySet.forEach(function (value)
    {
        console.log("Value: " + value);
    });
    // output will be:
    // Value: a
    // Value: b
    ```
    
## StrSet

This class has exactly the same interface like the Set, but values have to be strings only.

### Usage:

```javascript
var StrSet = require("backpack").collections.StrSet;
var mySet = new StrSet();
mySet.add("5");
mySet.add("bubu");
```

## Bag

Bag is a special kind of Map where one can put into many values behind a single key.

### Usage

```javascript
var Bag = require("backpack").collections.Bag;
var myBag = new Bag();
myBag.add("5", "pupu");
myBag.add("5", "pupu");
```

#### Reference:

*Properties:*

- **count** 
    
    Returns the items count.
    
- **collectionsCount**

    Returns the number of collections (as known as how many unique keys exists in the bag).
    
*Methods:*

- **add** (key, value)

    Adds a value into the collection behind the specified key.
    
    Returns the number of items reside in the collection behind the key after the addition.

- **set** (key, coll)

    Add the collection behind the specified key. It replaces an original if any exists.

- **get** (key)

    Returns the collection behind the specified key or *undefined* if doesn't exists.

- **remove** (key, value)

    - If value is *undefined*:
    
        Removes the collection behind the specified key.
        
        Returns *true* if the collection has existed else returns *false*.
    
    - If value is not *undefined*:
        
        Poo

- **clear** ()
- **forEach** (f)
- **forEachCollection** (f)
- **forEachKey** (f)
- **forEachValue** (f)