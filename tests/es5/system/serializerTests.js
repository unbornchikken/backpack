"use strict";
var Serializer = require("../../../").system.Serializer;
var util = require("util");
var assert = require("assert");
var _ = require("lodash");
describe("Serialize", function() {
  it("should serialize circular objects", function() {
    var ser = new Serializer();
    var a = {b: 5};
    a.c = a;
    var c = {
      b: 1,
      a: a,
      m: [1, 2, a]
    };
    c.d = a;
    c.x = c.m;
    var array = [a, c, a, null];
    var a2 = ser.parse(ser.stringify(a));
    var c2 = ser.fromJSON(ser.toJSON(c));
    var array2 = ser.parse(ser.stringify(array));
    assert.equal(a2.b, a.b);
    assert.equal(a2.c, a2);
    assert.equal(c2.b, c.b);
    assert.strictEqual(c2.d, c2.a);
    assert.ok(Array.isArray(c2.m));
    assert.equal(c2.m.length, c.m.length);
    assert.equal(c2.m[0], c.m[0]);
    assert.equal(c2.m[1], c.m[1]);
    assert.strictEqual(c2.m[2], c2.a);
    assert.strictEqual(c2.x, c2.m);
    assert.ok(Array.isArray(array2));
    assert.equal(array2.length, array.length);
    assert.equal(array2[0].b, a.b);
    assert.strictEqual(array2[0].c, array2[0]);
    assert.strictEqual(array2[2], array2[0]);
    assert.strictEqual(array2[3], null);
    var c3 = array2[1];
    assert.equal(c3.m.length, c.m.length);
    assert.equal(c3.m[0], c.m[0]);
    assert.equal(c3.m[1], c.m[1]);
    assert.strictEqual(c3.m[2], c3.a);
    assert.strictEqual(c3.m[2], array2[0]);
    assert.strictEqual(c3.m[2], array2[2]);
  });
  it("should serialize class hieararchies", function() {
    function Animal() {
      this.voice = null;
    }
    Animal.prototype.makeSound = function() {
      if (this.voice) {
        return "I say: " + this.voice + ".";
      }
    };
    function Cat() {
      Animal.call(this);
      this.voice = "meow";
    }
    util.inherits(Cat, Animal);
    function Dog() {
      Animal.call(this);
      this.voice = "bark";
    }
    util.inherits(Dog, Animal);
    function SpaceDog() {
      Dog.call(this);
      this.voice = "42";
    }
    util.inherits(SpaceDog, Dog);
    var cat = new Cat();
    var dog = new Dog();
    var spaceDog = new SpaceDog();
    spaceDog.futureStuff = function() {
      return "I think, therefore I am.";
    };
    assert.equal(cat.makeSound(), "I say: meow.");
    assert.equal(dog.makeSound(), "I say: bark.");
    assert.equal(spaceDog.makeSound(), "I say: 42.");
    assert.equal(spaceDog.futureStuff(), "I think, therefore I am.");
    assert.ok(cat instanceof Animal);
    assert.ok(cat instanceof Cat);
    assert.ok(dog instanceof Animal);
    assert.ok(dog instanceof Dog);
    assert.ok(spaceDog instanceof Animal);
    assert.ok(spaceDog instanceof Dog);
    assert.ok(spaceDog instanceof SpaceDog);
    var ser = new Serializer();
    ser.registerKnownType("Cat", Cat);
    ser.registerKnownType("Dog", Dog);
    ser.registerKnownType("SpaceDog", SpaceDog);
    var data = ser.stringify({
      cat: cat,
      dog: dog,
      spaceDog: spaceDog
    });
    assert.ok(typeof data === "string");
    var deserialized = ser.parse(data);
    assert.equal(deserialized.cat.makeSound(), "I say: meow.");
    assert.equal(deserialized.dog.makeSound(), "I say: bark.");
    assert.equal(deserialized.spaceDog.makeSound(), "I say: 42.");
    assert.equal(deserialized.spaceDog.futureStuff(), "I think, therefore I am.");
    assert.ok(deserialized.cat instanceof Animal);
    assert.ok(deserialized.cat instanceof Cat);
    assert.ok(deserialized.dog instanceof Animal);
    assert.ok(deserialized.dog instanceof Dog);
    assert.ok(deserialized.spaceDog instanceof Animal);
    assert.ok(deserialized.spaceDog instanceof Dog);
    assert.ok(deserialized.spaceDog instanceof SpaceDog);
  });
  it("should support custom serialization", function() {
    var constructed = 0;
    function Foo() {
      this.a = "a";
      this.b = "b";
    }
    function Boo() {
      Foo.call(this);
      this.c = "c";
      constructed++;
    }
    util.inherits(Boo, Foo);
    Boo.prototype.serializeToJSON = function() {
      return {
        a: this.a,
        b: this.b,
        c: this.c
      };
    };
    Boo.prototype.deserializeFromJSON = function(json) {
      this.a = json.a;
      this.b = json.b;
      this.c = json.c;
      this.boo = "boo";
    };
    var ser = new Serializer();
    ser.registerKnownType("Boo", Boo);
    var boo = new Boo();
    assert.equal(constructed, 1);
    assert.equal(boo.a, "a");
    assert.equal(boo.b, "b");
    assert.equal(boo.c, "c");
    assert.strictEqual(boo.boo, undefined);
    var boo2 = ser.fromJSON(ser.toJSON(boo));
    assert.equal(constructed, 1);
    assert.equal(boo2.a, "a");
    assert.equal(boo2.b, "b");
    assert.equal(boo2.c, "c");
    assert.strictEqual(boo2.boo, "boo");
    assert.ok(boo2 instanceof Boo);
    assert.ok(boo2 instanceof Foo);
    var map = new Map();
    var foo = new Foo();
    map.set(foo, boo);
    map.set(boo2, foo);
    ser.registerKnownType("Foo", Foo);
    var mapStr = ser.stringify(map);
    var map2 = ser.parse(mapStr);
    assert.equal(constructed, 1);
    assert.equal(map2.size, 2);
    var fooValue = null;
    var fooKey = null;
    map2.forEach(function(key, value) {
      if (key instanceof Boo) {
        assert.ok(value instanceof Foo && !(value instanceof Boo));
        fooValue = value;
      } else if (key instanceof Foo) {
        assert.ok(value instanceof Boo);
        assert.equal(value.boo, "boo");
        fooKey = key;
      } else {
        assert.fail("This is not possible.");
      }
    });
    assert.strictEqual(fooKey, fooValue);
  });
  it("should support Map", function() {
    var map = new Map();
    map.set("a", "b");
    map.set("c", "d");
    var ser = new Serializer();
    var data = ser.toJSON(map);
    var otherMap = ser.fromJSON(data);
    assert.ok(otherMap instanceof Map);
    assert.equal(otherMap.size, 2);
    assert.equal(otherMap.get("a"), map.get("a"));
    assert.equal(otherMap.get("c"), map.get("c"));
  });
  it("should support Set", function() {
    var set = new Set();
    set.add("a");
    set.add("b");
    set.add("c");
    set.add(["d", {e: "f"}]);
    var ser = new Serializer();
    var data = ser.toJSON(set);
    var otherSet = ser.fromJSON(data);
    assert.ok(otherSet instanceof Set);
    assert.equal(otherSet.size, 4);
    assert(otherSet.has("a"));
    assert(otherSet.has("b"));
    assert(otherSet.has("c"));
    var all = [];
    var $__4 = true;
    var $__5 = false;
    var $__6 = undefined;
    try {
      for (var $__2 = void 0,
          $__1 = (otherSet.values())[$traceurRuntime.toProperty(Symbol.iterator)](); !($__4 = ($__2 = $__1.next()).done); $__4 = true) {
        var item = $__2.value;
        {
          all.push(item);
        }
      }
    } catch ($__7) {
      $__5 = true;
      $__6 = $__7;
    } finally {
      try {
        if (!$__4 && $__1.return != null) {
          $__1.return();
        }
      } finally {
        if ($__5) {
          throw $__6;
        }
      }
    }
    var obj = _(all).filter(function(i) {
      return _.isArray(i);
    }).first();
    assert(_.isArray(obj));
    assert.equal(obj[0], "d");
    assert(_.isObject(obj[1]));
    assert.equal(obj[1].e, "f");
  });
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInNlcmlhbGl6ZXJUZXN0cy5qcyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQTtBQUlBLEFBQUksRUFBQSxDQUFBLFVBQVMsRUFBSSxDQUFBLE9BQU0sQUFBQyxDQUFDLFdBQVUsQ0FBQyxPQUFPLFdBQVcsQ0FBQztBQUN2RCxBQUFJLEVBQUEsQ0FBQSxJQUFHLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxNQUFLLENBQUMsQ0FBQztBQUMxQixBQUFJLEVBQUEsQ0FBQSxNQUFLLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ0FBQztBQUM5QixBQUFJLEVBQUEsQ0FBQSxDQUFBLEVBQUksQ0FBQSxPQUFNLEFBQUMsQ0FBQyxRQUFPLENBQUMsQ0FBQztBQUV6QixPQUFPLEFBQUMsQ0FBQyxXQUFVLENBQUcsVUFBVSxBQUFEO0FBQzNCLEdBQUMsQUFBQyxDQUFDLG1DQUFrQyxDQUFHLFVBQVUsQUFBRCxDQUFHO0FBQ2hELEFBQUksTUFBQSxDQUFBLEdBQUUsRUFBSSxJQUFJLFdBQVMsQUFBQyxFQUFDLENBQUM7QUFFMUIsQUFBSSxNQUFBLENBQUEsQ0FBQSxFQUFJLEVBQUUsQ0FBQSxDQUFHLEVBQUEsQ0FBRSxDQUFDO0FBQ2hCLElBQUEsRUFBRSxFQUFJLEVBQUEsQ0FBQztBQUNQLEFBQUksTUFBQSxDQUFBLENBQUEsRUFBSTtBQUFFLE1BQUEsQ0FBRyxFQUFBO0FBQUcsTUFBQSxDQUFHLEVBQUE7QUFBRyxNQUFBLENBQUcsRUFBQyxDQUFBLENBQUcsRUFBQSxDQUFHLEVBQUEsQ0FBQztBQUFBLElBQUUsQ0FBQztBQUNwQyxJQUFBLEVBQUUsRUFBSSxFQUFBLENBQUM7QUFDUCxJQUFBLEVBQUUsRUFBSSxDQUFBLENBQUEsRUFBRSxDQUFDO0FBRVQsQUFBSSxNQUFBLENBQUEsS0FBSSxFQUFJLEVBQUMsQ0FBQSxDQUFHLEVBQUEsQ0FBRyxFQUFBLENBQUcsS0FBRyxDQUFDLENBQUM7QUFFM0IsQUFBSSxNQUFBLENBQUEsRUFBQyxFQUFJLENBQUEsR0FBRSxNQUFNLEFBQUMsQ0FBQyxHQUFFLFVBQVUsQUFBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUM7QUFDcEMsQUFBSSxNQUFBLENBQUEsRUFBQyxFQUFJLENBQUEsR0FBRSxTQUFTLEFBQUMsQ0FBQyxHQUFFLE9BQU8sQUFBQyxDQUFDLENBQUEsQ0FBQyxDQUFDLENBQUM7QUFDcEMsQUFBSSxNQUFBLENBQUEsTUFBSyxFQUFJLENBQUEsR0FBRSxNQUFNLEFBQUMsQ0FBQyxHQUFFLFVBQVUsQUFBQyxDQUFDLEtBQUksQ0FBQyxDQUFDLENBQUM7QUFFNUMsU0FBSyxNQUFNLEFBQUMsQ0FBQyxFQUFDLEVBQUUsQ0FBRyxDQUFBLENBQUEsRUFBRSxDQUFDLENBQUM7QUFDdkIsU0FBSyxNQUFNLEFBQUMsQ0FBQyxFQUFDLEVBQUUsQ0FBRyxHQUFDLENBQUMsQ0FBQztBQUV0QixTQUFLLE1BQU0sQUFBQyxDQUFDLEVBQUMsRUFBRSxDQUFHLENBQUEsQ0FBQSxFQUFFLENBQUMsQ0FBQztBQUN2QixTQUFLLFlBQVksQUFBQyxDQUFDLEVBQUMsRUFBRSxDQUFHLENBQUEsRUFBQyxFQUFFLENBQUMsQ0FBQztBQUM5QixTQUFLLEdBQUcsQUFBQyxDQUFDLEtBQUksUUFBUSxBQUFDLENBQUMsRUFBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO0FBQzlCLFNBQUssTUFBTSxBQUFDLENBQUMsRUFBQyxFQUFFLE9BQU8sQ0FBRyxDQUFBLENBQUEsRUFBRSxPQUFPLENBQUMsQ0FBQztBQUNyQyxTQUFLLE1BQU0sQUFBQyxDQUFDLEVBQUMsRUFBRSxDQUFFLENBQUEsQ0FBQyxDQUFHLENBQUEsQ0FBQSxFQUFFLENBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQztBQUM3QixTQUFLLE1BQU0sQUFBQyxDQUFDLEVBQUMsRUFBRSxDQUFFLENBQUEsQ0FBQyxDQUFHLENBQUEsQ0FBQSxFQUFFLENBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQztBQUM3QixTQUFLLFlBQVksQUFBQyxDQUFDLEVBQUMsRUFBRSxDQUFFLENBQUEsQ0FB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QUFFLENBQUMsT0FBTyxBQUFDLENBQUMsU0FBUyxDQUFBLENBQUc7QUFBRSxXQUFPLENBQUEsQ0FBQSxRQUFRLEFBQUMsQ0FBQyxDQUFBLENBQUMsQ0FBQztJQUFFLENBQUMsTUFBTSxBQUFDLEVBQUMsQ0FBQztBQUNyRSxTQUFLLEFBQUMsQ0FBQyxDQUFBLFFBQVEsQUFBQyxDQUFDLEdBQUUsQ0FBQyxDQUFDLENBQUM7QUFDdEIsU0FBSyxNQUFNLEFBQUMsQ0FBQyxHQUFFLENBQUUsQ0FBQSxDQUFDLENBQUcsSUFBRSxDQUFDLENBQUM7QUFDekIsU0FBSyxBQUFDLENBQUMsQ0FBQSxTQUFTLEFBQUMsQ0FBQyxHQUFFLENBQUUsQ0FBQSxDQUFDLENBQUMsQ0FBQyxDQUFDO0FBQzFCLFNBQUssTUFBTSxBQUFDLENBQUMsR0FBRSxDQUFFLENBQUEsQ0FBQyxFQUFFLENBQUcsSUFBRSxDQUFDLENBQUM7RUFDL0IsQ0FBQyxDQUFDO0FBQ04sQ0FBQyxDQUFDO0FBQ0YiLCJmaWxlIjoic3lzdGVtL3NlcmlhbGl6ZXJUZXN0cy5qcyIsInNvdXJjZVJvb3QiOiJ0ZXN0cy9lczYiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcclxuXHJcbi8qIGdsb2JhbCBkZXNjcmliZSxpdCAqL1xyXG5cclxubGV0IFNlcmlhbGl6ZXIgPSByZXF1aXJlKFwiLi4vLi4vLi4vXCIpLnN5c3RlbS5TZXJpYWxpemVyO1xyXG5sZXQgdXRpbCA9IHJlcXVpcmUoXCJ1dGlsXCIpO1xyXG5sZXQgYXNzZXJ0ID0gcmVxdWlyZShcImFzc2VydFwiKTtcclxubGV0IF8gPSByZXF1aXJlKFwibG9kYXNoXCIpO1xyXG5cclxuZGVzY3JpYmUoXCJTZXJpYWxpemVcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgaXQoXCJzaG91bGQgc2VyaWFsaXplIGNpcmN1bGFyIG9iamVjdHNcIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxldCBzZXIgPSBuZXcgU2VyaWFsaXplcigpO1xyXG5cclxuICAgICAgICBsZXQgYSA9IHsgYjogNSB9O1xyXG4gICAgICAgIGEuYyA9IGE7XHJcbiAgICAgICAgbGV0IGMgPSB7IGI6IDEsIGE6IGEsIG06IFsxLCAyLCBhXSB9O1xyXG4gICAgICAgIGMuZCA9IGE7XHJcbiAgICAgICAgYy54ID0gYy5tO1xyXG5cclxuICAgICAgICBsZXQgYXJyYXkgPSBbYSwgYywgYSwgbnVsbF07XHJcblxyXG4gICAgICAgIGxldCBhMiA9IHNlci5wYXJzZShzZXIuc3RyaW5naWZ5KGEpKTtcclxuICAgICAgICBsZXQgYzIgPSBzZXIuZnJvbUpTT04oc2VyLnRvSlNPTihjKSk7XHJcbiAgICAgICAgbGV0IGFycmF5MiA9IHNlci5wYXJzZShzZXIuc3RyaW5naWZ5KGFycmF5KSk7XHJcblxyXG4gICAgICAgIGFzc2VydC5lcXVhbChhMi5iLCBhLmIpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChhMi5jLCBhMik7XHJcblxyXG4gICAgICAgIGFzc2VydC5lcXVhbChjMi5iLCBjLmIpO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChjMi5kLCBjMi5hKTtcclxuICAgICAgICBhc3NlcnQub2soQXJyYXkuaXNBcnJheShjMi5tKSk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGMyLm0ubGVuZ3RoLCBjLm0ubGVuZ3RoKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoYzIubVswXSwgYy5tWzBdKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoYzIubVsxXSwgYy5tWzFdKTtcclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwoYzIubVsyXSwgYzIuYSk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKGMyLngsIGMyLm0pO1xyXG5cclxuICAgICAgICBhc3NlcnQub2soQXJyYXkuaXNBcnJheShhcnJheTIpKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoYXJyYXkyLmxlbmd0aCwgYXJyYXkubGVuZ3RoKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoYXJyYXkyWzBdLmIsIGEuYik7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKGFycmF5MlswXS5jLCBhcnJheTJbMF0pO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChhcnJheTJbMl0sIGFycmF5MlswXSk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKGFycmF5MlszXSwgbnVsbCk7XHJcbiAgICAgICAgbGV0IGMzID0gYXJyYXkyWzFdO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChjMy5tLmxlbmd0aCwgYy5tLmxlbmd0aCk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGMzLm1bMF0sIGMubVswXSk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGMzLm1bMV0sIGMubVsxXSk7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKGMzLm1bMl0sIGMzLmEpO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChjMy5tWzJdLCBhcnJheTJbMF0pO1xyXG4gICAgICAgIGFzc2VydC5zdHJpY3RFcXVhbChjMy5tWzJdLCBhcnJheTJbMl0pO1xyXG4gICAgfSk7XHJcblxyXG4gICAgaXQoXCJzaG91bGQgc2VyaWFsaXplIGNsYXNzIGhpZWFyYXJjaGllc1wiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgZnVuY3Rpb24gQW5pbWFsKCkge1xyXG4gICAgICAgICAgICB0aGlzLnZvaWNlID0gbnVsbDtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIEFuaW1hbC5wcm90b3R5cGUubWFrZVNvdW5kID0gZnVuY3Rpb24gKCkge1xyXG4gICAgICAgICAgICBpZiAodGhpcy52b2ljZSkge1xyXG4gICAgICAgICAgICAgICAgcmV0dXJuIFwiSSBzYXk6IFwiICsgdGhpcy52b2ljZSArIFwiLlwiO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQ2F0KCkge1xyXG4gICAgICAgICAgICBBbmltYWwuY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy52b2ljZSA9IFwibWVvd1wiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgdXRpbC5pbmhlcml0cyhDYXQsIEFuaW1hbCk7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIERvZygpIHtcclxuICAgICAgICAgICAgQW5pbWFsLmNhbGwodGhpcyk7XHJcbiAgICAgICAgICAgIHRoaXMudm9pY2UgPSBcImJhcmtcIjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHV0aWwuaW5oZXJpdHMoRG9nLCBBbmltYWwpO1xyXG5cclxuICAgICAgICBmdW5jdGlvbiBTcGFjZURvZygpIHtcclxuICAgICAgICAgICAgRG9nLmNhbGwodGhpcyk7XHJcbiAgICAgICAgICAgIHRoaXMudm9pY2UgPSBcIjQyXCI7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB1dGlsLmluaGVyaXRzKFNwYWNlRG9nLCBEb2cpO1xyXG5cclxuICAgICAgICBsZXQgY2F0ID0gbmV3IENhdCgpO1xyXG4gICAgICAgIGxldCBkb2cgPSBuZXcgRG9nKCk7XHJcbiAgICAgICAgbGV0IHNwYWNlRG9nID0gbmV3IFNwYWNlRG9nKCk7XHJcbiAgICAgICAgLy8gQWRkIGFuIGluc3RhbmNlLW9ubHkgZnVuY3Rpb246XHJcbiAgICAgICAgc3BhY2VEb2cuZnV0dXJlU3R1ZmYgPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiBcIkkgdGhpbmssIHRoZXJlZm9yZSBJIGFtLlwiO1xyXG4gICAgICAgIH07XHJcblxyXG4gICAgICAgIGFzc2VydC5lcXVhbChjYXQubWFrZVNvdW5kKCksIFwiSSBzYXk6IG1lb3cuXCIpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChkb2cubWFrZVNvdW5kKCksIFwiSSBzYXk6IGJhcmsuXCIpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChzcGFjZURvZy5tYWtlU291bmQoKSwgXCJJIHNheTogNDIuXCIpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChzcGFjZURvZy5mdXR1cmVTdHVmZigpLCBcIkkgdGhpbmssIHRoZXJlZm9yZSBJIGFtLlwiKTtcclxuICAgICAgICBhc3NlcnQub2soY2F0IGluc3RhbmNlb2YgQW5pbWFsKTtcclxuICAgICAgICBhc3NlcnQub2soY2F0IGluc3RhbmNlb2YgQ2F0KTtcclxuICAgICAgICBhc3NlcnQub2soZG9nIGluc3RhbmNlb2YgQW5pbWFsKTtcclxuICAgICAgICBhc3NlcnQub2soZG9nIGluc3RhbmNlb2YgRG9nKTtcclxuICAgICAgICBhc3NlcnQub2soc3BhY2VEb2cgaW5zdGFuY2VvZiBBbmltYWwpO1xyXG4gICAgICAgIGFzc2VydC5vayhzcGFjZURvZyBpbnN0YW5jZW9mIERvZyk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKHNwYWNlRG9nIGluc3RhbmNlb2YgU3BhY2VEb2cpO1xyXG5cclxuICAgICAgICBsZXQgc2VyID0gbmV3IFNlcmlhbGl6ZXIoKTtcclxuICAgICAgICBzZXIucmVnaXN0ZXJLbm93blR5cGUoXCJDYXRcIiwgQ2F0KTtcclxuICAgICAgICBzZXIucmVnaXN0ZXJLbm93blR5cGUoXCJEb2dcIiwgRG9nKTtcclxuICAgICAgICBzZXIucmVnaXN0ZXJLbm93blR5cGUoXCJTcGFjZURvZ1wiLCBTcGFjZURvZyk7XHJcblxyXG4gICAgICAgIGxldCBkYXRhID0gc2VyLnN0cmluZ2lmeShcclxuICAgICAgICAgICAge1xyXG4gICAgICAgICAgICAgICAgY2F0OiBjYXQsXHJcbiAgICAgICAgICAgICAgICBkb2c6IGRvZyxcclxuICAgICAgICAgICAgICAgIHNwYWNlRG9nOiBzcGFjZURvZ1xyXG4gICAgICAgICAgICB9KTtcclxuXHJcbiAgICAgICAgYXNzZXJ0Lm9rKHR5cGVvZiBkYXRhID09PSBcInN0cmluZ1wiKTtcclxuXHJcbiAgICAgICAgbGV0IGRlc2VyaWFsaXplZCA9IHNlci5wYXJzZShkYXRhKTtcclxuXHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGRlc2VyaWFsaXplZC5jYXQubWFrZVNvdW5kKCksIFwiSSBzYXk6IG1lb3cuXCIpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChkZXNlcmlhbGl6ZWQuZG9nLm1ha2VTb3VuZCgpLCBcIkkgc2F5OiBiYXJrLlwiKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoZGVzZXJpYWxpemVkLnNwYWNlRG9nLm1ha2VTb3VuZCgpLCBcIkkgc2F5OiA0Mi5cIik7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGRlc2VyaWFsaXplZC5zcGFjZURvZy5mdXR1cmVTdHVmZigpLCBcIkkgdGhpbmssIHRoZXJlZm9yZSBJIGFtLlwiKTtcclxuICAgICAgICBhc3NlcnQub2soZGVzZXJpYWxpemVkLmNhdCBpbnN0YW5jZW9mIEFuaW1hbCk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKGRlc2VyaWFsaXplZC5jYXQgaW5zdGFuY2VvZiBDYXQpO1xyXG4gICAgICAgIGFzc2VydC5vayhkZXNlcmlhbGl6ZWQuZG9nIGluc3RhbmNlb2YgQW5pbWFsKTtcclxuICAgICAgICBhc3NlcnQub2soZGVzZXJpYWxpemVkLmRvZyBpbnN0YW5jZW9mIERvZyk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKGRlc2VyaWFsaXplZC5zcGFjZURvZyBpbnN0YW5jZW9mIEFuaW1hbCk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKGRlc2VyaWFsaXplZC5zcGFjZURvZyBpbnN0YW5jZW9mIERvZyk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKGRlc2VyaWFsaXplZC5zcGFjZURvZyBpbnN0YW5jZW9mIFNwYWNlRG9nKTtcclxuICAgIH0pO1xyXG5cclxuICAgIGl0KFwic2hvdWxkIHN1cHBvcnQgY3VzdG9tIHNlcmlhbGl6YXRpb25cIiwgZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIGxldCBjb25zdHJ1Y3RlZCA9IDA7XHJcblxyXG4gICAgICAgIGZ1bmN0aW9uIEZvbygpIHtcclxuICAgICAgICAgICAgdGhpcy5hID0gXCJhXCI7XHJcbiAgICAgICAgICAgIHRoaXMuYiA9IFwiYlwiO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgZnVuY3Rpb24gQm9vKCkge1xyXG4gICAgICAgICAgICBGb28uY2FsbCh0aGlzKTtcclxuICAgICAgICAgICAgdGhpcy5jID0gXCJjXCI7XHJcbiAgICAgICAgICAgIGNvbnN0cnVjdGVkKys7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICB1dGlsLmluaGVyaXRzKEJvbywgRm9vKTtcclxuXHJcbiAgICAgICAgQm9vLnByb3RvdHlwZS5zZXJpYWxpemVUb0pTT04gPSBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgICAgIHJldHVybiB7XHJcbiAgICAgICAgICAgICAgICBhOiB0aGlzLmEsXHJcbiAgICAgICAgICAgICAgICBiOiB0aGlzLmIsXHJcbiAgICAgICAgICAgICAgICBjOiB0aGlzLmNcclxuICAgICAgICAgICAgfTtcclxuICAgICAgICB9O1xyXG5cclxuICAgICAgICBCb28ucHJvdG90eXBlLmRlc2VyaWFsaXplRnJvbUpTT04gPSBmdW5jdGlvbiAoanNvbikge1xyXG4gICAgICAgICAgICB0aGlzLmEgPSBqc29uLmE7XHJcbiAgICAgICAgICAgIHRoaXMuYiA9IGpzb24uYjtcclxuICAgICAgICAgICAgdGhpcy5jID0ganNvbi5jO1xyXG4gICAgICAgICAgICB0aGlzLmJvbyA9IFwiYm9vXCI7XHJcbiAgICAgICAgfTtcclxuXHJcbiAgICAgICAgbGV0IHNlciA9IG5ldyBTZXJpYWxpemVyKCk7XHJcbiAgICAgICAgc2VyLnJlZ2lzdGVyS25vd25UeXBlKFwiQm9vXCIsIEJvbyk7XHJcblxyXG4gICAgICAgIGxldCBib28gPSBuZXcgQm9vKCk7XHJcblxyXG4gICAgICAgIGFzc2VydC5lcXVhbChjb25zdHJ1Y3RlZCwgMSk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGJvby5hLCBcImFcIik7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGJvby5iLCBcImJcIik7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGJvby5jLCBcImNcIik7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKGJvby5ib28sIHVuZGVmaW5lZCk7XHJcblxyXG4gICAgICAgIGxldCBib28yID0gc2VyLmZyb21KU09OKHNlci50b0pTT04oYm9vKSk7XHJcblxyXG4gICAgICAgIGFzc2VydC5lcXVhbChjb25zdHJ1Y3RlZCwgMSk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGJvbzIuYSwgXCJhXCIpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChib28yLmIsIFwiYlwiKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwoYm9vMi5jLCBcImNcIik7XHJcbiAgICAgICAgYXNzZXJ0LnN0cmljdEVxdWFsKGJvbzIuYm9vLCBcImJvb1wiKTtcclxuICAgICAgICBhc3NlcnQub2soYm9vMiBpbnN0YW5jZW9mIEJvbyk7XHJcbiAgICAgICAgYXNzZXJ0Lm9rKGJvbzIgaW5zdGFuY2VvZiBGb28pO1xyXG5cclxuICAgICAgICBsZXQgbWFwID0gbmV3IE1hcCgpO1xyXG4gICAgICAgIGxldCBmb28gPSBuZXcgRm9vKCk7XHJcblxyXG4gICAgICAgIG1hcC5zZXQoZm9vLCBib28pO1xyXG4gICAgICAgIG1hcC5zZXQoYm9vMiwgZm9vKTtcclxuXHJcbiAgICAgICAgc2VyLnJlZ2lzdGVyS25vd25UeXBlKFwiRm9vXCIsIEZvbyk7XHJcblxyXG4gICAgICAgIGxldCBtYXBTdHIgPSBzZXIuc3RyaW5naWZ5KG1hcCk7XHJcbiAgICAgICAgbGV0IG1hcDIgPSBzZXIucGFyc2UobWFwU3RyKTtcclxuXHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKGNvbnN0cnVjdGVkLCAxKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwobWFwMi5zaXplLCAyKTtcclxuXHJcbiAgICAgICAgbGV0IGZvb1ZhbHVlID0gbnVsbDtcclxuICAgICAgICBsZXQgZm9vS2V5ID0gbnVsbDtcclxuICAgICAgICBtYXAyLmZvckVhY2goZnVuY3Rpb24gKGtleSwgdmFsdWUpIHtcclxuICAgICAgICAgICAgaWYgKGtleSBpbnN0YW5jZW9mIEJvbykge1xyXG4gICAgICAgICAgICAgICAgYXNzZXJ0Lm9rKHZhbHVlIGluc3RhbmNlb2YgRm9vICYmICEodmFsdWUgaW5zdGFuY2VvZiBCb28pKTtcclxuICAgICAgICAgICAgICAgIGZvb1ZhbHVlID0gdmFsdWU7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSBpZiAoa2V5IGluc3RhbmNlb2YgRm9vKSB7XHJcbiAgICAgICAgICAgICAgICBhc3NlcnQub2sodmFsdWUgaW5zdGFuY2VvZiBCb28pO1xyXG4gICAgICAgICAgICAgICAgYXNzZXJ0LmVxdWFsKHZhbHVlLmJvbywgXCJib29cIik7XHJcbiAgICAgICAgICAgICAgICBmb29LZXkgPSBrZXk7XHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgZWxzZSB7XHJcbiAgICAgICAgICAgICAgICBhc3NlcnQuZmFpbChcIlRoaXMgaXMgbm90IHBvc3NpYmxlLlwiKTtcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pO1xyXG5cclxuICAgICAgICBhc3NlcnQuc3RyaWN0RXF1YWwoZm9vS2V5LCBmb29WYWx1ZSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcInNob3VsZCBzdXBwb3J0IE1hcFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbGV0IG1hcCA9IG5ldyBNYXAoKTtcclxuICAgICAgICBtYXAuc2V0KFwiYVwiLCBcImJcIik7XHJcbiAgICAgICAgbWFwLnNldChcImNcIiwgXCJkXCIpO1xyXG4gICAgICAgIGxldCBzZXIgPSBuZXcgU2VyaWFsaXplcigpO1xyXG4gICAgICAgIGxldCBkYXRhID0gc2VyLnRvSlNPTihtYXApO1xyXG4gICAgICAgIGxldCBvdGhlck1hcCA9IHNlci5mcm9tSlNPTihkYXRhKTtcclxuICAgICAgICBhc3NlcnQub2sob3RoZXJNYXAgaW5zdGFuY2VvZiBNYXApO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChvdGhlck1hcC5zaXplLCAyKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwob3RoZXJNYXAuZ2V0KFwiYVwiKSwgbWFwLmdldChcImFcIikpO1xyXG4gICAgICAgIGFzc2VydC5lcXVhbChvdGhlck1hcC5nZXQoXCJjXCIpLCBtYXAuZ2V0KFwiY1wiKSk7XHJcbiAgICB9KTtcclxuXHJcbiAgICBpdChcInNob3VsZCBzdXBwb3J0IFNldFwiLCBmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgbGV0IHNldCA9IG5ldyBTZXQoKTtcclxuICAgICAgICBzZXQuYWRkKFwiYVwiKTtcclxuICAgICAgICBzZXQuYWRkKFwiYlwiKTtcclxuICAgICAgICBzZXQuYWRkKFwiY1wiKTtcclxuICAgICAgICBzZXQuYWRkKFtcImRcIiwgeyBlOiBcImZcIiB9XSk7XHJcbiAgICAgICAgbGV0IHNlciA9IG5ldyBTZXJpYWxpemVyKCk7XHJcbiAgICAgICAgbGV0IGRhdGEgPSBzZXIudG9KU09OKHNldCk7XHJcbiAgICAgICAgbGV0IG90aGVyU2V0ID0gc2VyLmZyb21KU09OKGRhdGEpO1xyXG4gICAgICAgIGFzc2VydC5vayhvdGhlclNldCBpbnN0YW5jZW9mIFNldCk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKG90aGVyU2V0LnNpemUsIDQpO1xyXG4gICAgICAgIGFzc2VydChvdGhlclNldC5oYXMoXCJhXCIpKTtcclxuICAgICAgICBhc3NlcnQob3RoZXJTZXQuaGFzKFwiYlwiKSk7XHJcbiAgICAgICAgYXNzZXJ0KG90aGVyU2V0LmhhcyhcImNcIikpO1xyXG4gICAgICAgIGxldCBhbGwgPSBbXTtcclxuICAgICAgICBmb3IgKGxldCBpdGVtIG9mIG90aGVyU2V0LnZhbHVlcygpKSB7XHJcbiAgICAgICAgICAgIGFsbC5wdXNoKGl0ZW0pO1xyXG4gICAgICAgIH1cclxuICAgICAgICBsZXQgb2JqID0gXyhhbGwpLmZpbHRlcihmdW5jdGlvbihpKSB7IHJldHVybiBfLmlzQXJyYXkoaSk7IH0pLmZpcnN0KCk7XHJcbiAgICAgICAgYXNzZXJ0KF8uaXNBcnJheShvYmopKTtcclxuICAgICAgICBhc3NlcnQuZXF1YWwob2JqWzBdLCBcImRcIik7XHJcbiAgICAgICAgYXNzZXJ0KF8uaXNPYmplY3Qob2JqWzFdKSk7XHJcbiAgICAgICAgYXNzZXJ0LmVxdWFsKG9ialsxXS5lLCBcImZcIik7XHJcbiAgICB9KTtcclxufSk7XHJcbiJdfQ==
